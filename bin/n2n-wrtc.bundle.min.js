!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("n2n",[],t):"object"==typeof exports?exports.n2n=t():e.n2n=t()}(window,function(){return function(n){var r={};function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}return o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=47)}([function(x,y){function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var A;A=function(){return this}();try{A=A||Function("return this")()||eval("this")}catch(e){"object"===("undefined"==typeof window?"undefined":z(window))&&(A=window)}x.exports=A},function(e,t){var n,r,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,u=[],f=!1,l=-1;function h(){f&&c&&(f=!1,c.length?u=c.concat(u):l=-1,u.length&&p())}function p(){if(!f){var e=a(h);f=!0;for(var t=u.length;t;){for(c=u,u=[];++l<t;)c&&c[l].run();l=-1,t=u.length}c=null,f=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new d(e,t)),1!==u.length||f||a(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(o,r,e){(function(t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":n(console))&&console.log&&(e=console).log.apply(e,arguments)},r.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+o.exports.humanize(this.diff),!this.useColors)return;var t="color: "+this.color;e.splice(1,0,t,"color: inherit");var n=0,r=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(n++,"%c"===e&&(r=n))}),e.splice(r,0,t)},r.save=function(e){try{e?r.storage.setItem("debug",e):r.storage.removeItem("debug")}catch(e){}},r.load=function(){var e;try{e=r.storage.getItem("debug")}catch(e){}!e&&void 0!==t&&"env"in t&&(e=t.env.DEBUG);return e},r.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage=function(){try{return localStorage}catch(e){}}(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],o.exports=e(87)(r),o.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,e(1))},function(e,t){e.exports={socket:{RECEIVE_OFFER:"socket-ro",EMIT_OFFER:"socket-eo",EMIT_OFFER_RENEGOCIATE:"socket-eo-r"},signaling:{RECEIVE_OFFER:"signalig-ro",EMIT_OFFER:"signaling-eo"},neighborhood:{OCC_INC:"o:i",OCC_DEC:"o:d"},n2n:{connection:{out:"out",in:"in"},disconnection:{out:"close_out",in:"close_in"},crash:{out:"crash_out",in:"crash_in"},DISCONNECT:"disc",INC_IN:"inc:in",DEC_IN:"dec:in",CONNECT_TO_US:"c:2:u",DIRECT_TO:"d:2",DIRECT_BACK:"d:b",LOCK:"l",UNLOCK:"ul",bridgeIO:{BRIDGE:"bio",BRIDGE_FORWARD:"bio:f",BRIDGE_FORWARD_BACK:"bio:f:b",BRIDGE_FORWARD_RESPONSE:"bio:fr"},bridgeOO:{BRIDGE:"boo",BRIDGE_FORWARD:"boo:f",BRIDGE_FORWARD_BACK:"boo:f:b",BRIDGE_FORWARD_RESPONSE:"boo:fr"},bridgeOI:{BRIDGE:"b",BRIDGE_FORWARD:"boi:f",BRIDGE_FORWARD_BACK:"boi:f:b",BRIDGE_FORWARD_RESPONSE:"boi:fr"},RESPONSE:"r"}}},function(e,t,n){var o=n(52),i=n(54),s="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ";function a(e,t){return t(e.toLowerCase().replace(/-/g,""))}e.exports=function(){function e(e){var t=e||s,n=o(o.HEX,t),r=o(t,o.HEX);return{new:function(){return a(i(),n)},uuid:i,fromUUID:function(e){return a(e,n)},toUUID:function(e){return function(e,t){for(var n,r=t(e),o="",i=0,s=32-r.length;i<s;++i)o+="0";return[(n=(o+r).match(/(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})/))[1],n[2],n[3],n[4],n[5]].join("-")}(e,r)},alphabet:t}}return e.constants={flickrBase58:s,cookieBase90:"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!#$%&'()*+-./:<=>?@[]^_`{|}~"},e.uuid=i,e}()},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function u(a){return function(){var e=this,s=arguments;return new Promise(function(t,n){var r=a.apply(e,s);function o(e){c(r,t,n,o,i,"next",e)}function i(e){c(r,t,n,o,i,"throw",e)}o(void 0)})}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=n(16),g=n(6),y=n(3),o=function(e){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=l(this,h(n).call(this))).options=t,e}var t,r,o,i,s,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(n,g),t=n,(r=[{key:"connect",value:(a=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject(d.nyi()));case 1:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"getNewPeer",value:(s=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject(d.nyi()));case 1:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"sendOffer",value:(i=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject(d.nyi()));case 1:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"receiveOffer",value:function(e){this.emit(y.signaling.RECEIVE_OFFER,e)}}])&&f(t.prototype,r),o&&f(t,o),n}();e.exports=o},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function c(e){return"function"==typeof e}function u(e){return"object"===n(e)&&null!==e}function f(e){return void 0===e}((e.exports=r).EventEmitter=r).prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,o,i,s;if(this._events||(this._events={}),"error"===e&&(!this._events.error||u(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var a=new Error('Uncaught, unspecified "error" event. ('+t+")");throw a.context=t,a}if(f(n=this._events[e]))return!1;if(c(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(u(n))for(o=Array.prototype.slice.call(arguments,1),r=(s=n.slice()).length,i=0;i<r;i++)s[i].apply(this,o);return!0},r.prototype.on=r.prototype.addListener=function(e,t){var n;if(!c(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,c(t.listener)?t.listener:t),this._events[e]?u(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,u(this._events[e])&&!this._events[e].warned&&(n=f(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&0<n&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.once=function(e,t){if(!c(t))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var n,r,o,i;if(!c(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,r=-1,n===t||c(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(u(n)){for(i=o;0<i--;)if(n[i]===t||n[i].listener&&n[i].listener===t){r=i;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(c(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?c(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(c(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){e.exports={online:n(57),offline:n(86),bridgeIO:n(88),bridgeOO:n(89),bridgeOI:n(90),direct:n(91),abstract:n(5)}},function(e,t,n){function r(e){if(e)return function(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}(e)}(e.exports=r).prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,h,t){var o,n=t(70),i=t(31),p=t(74),a=t(75),u=t(76);"undefined"!=typeof ArrayBuffer&&(o=t(77));var r="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),s="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),f=r||s;h.protocol=3;var l=h.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},c=n(l),d={type:"error",data:"parser error"},g=t(78);function y(e,t,n){for(var o=new Array(e.length),r=a(e.length,n),i=function(n,e,r){t(e,function(e,t){o[n]=t,r(e,o)})},s=0;s<e.length;s++)i(s,e[s],r)}h.encodePacket=function(e,t,n,r){"function"==typeof t&&(r=t,t=!1),"function"==typeof n&&(r=n,n=null);var o,i,s,a=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer)return function(e,t,n){if(!t)return h.encodeBase64Packet(e,n);var r=e.data,o=new Uint8Array(r),i=new Uint8Array(1+r.byteLength);i[0]=l[e.type];for(var s=0;s<o.length;s++)i[s+1]=o[s];return n(i.buffer)}(e,t,r);if(void 0!==g&&a instanceof g)return function(e,t,n){if(!t)return h.encodeBase64Packet(e,n);if(f)return function(e,t,n){if(!t)return h.encodeBase64Packet(e,n);var r=new FileReader;return r.onload=function(){h.encodePacket({type:e.type,data:r.result},t,!0,n)},r.readAsArrayBuffer(e.data)}(e,t,n);var r=new Uint8Array(1);r[0]=l[e.type];var o=new g([r.buffer,e.data]);return n(o)}(e,t,r);if(a&&a.base64)return o=e,i=r,s="b"+h.packets[o.type]+o.data.data,i(s);var c=l[e.type];return void 0!==e.data&&(c+=n?u.encode(String(e.data),{strict:!1}):String(e.data)),r(""+c)},h.encodeBase64Packet=function(t,n){var r,o="b"+h.packets[t.type];if(void 0!==g&&t.data instanceof g){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];n(o+e)},i.readAsDataURL(t.data)}try{r=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){for(var s=new Uint8Array(t.data),a=new Array(s.length),c=0;c<s.length;c++)a[c]=s[c];r=String.fromCharCode.apply(null,a)}return o+=btoa(r),n(o)},h.decodePacket=function(e,t,n){if(void 0===e)return d;if("string"==typeof e){if("b"===e.charAt(0))return h.decodeBase64Packet(e.substr(1),t);if(n&&!1===(e=function(e){try{e=u.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return d;var r=e.charAt(0);return Number(r)==r&&c[r]?1<e.length?{type:c[r],data:e.substring(1)}:{type:c[r]}:d}r=new Uint8Array(e)[0];var o=p(e,1);return g&&"blob"===t&&(o=new g([o])),{type:c[r],data:o}},h.decodeBase64Packet=function(e,t){var n=c[e.charAt(0)];if(!o)return{type:n,data:{base64:!0,data:e.substr(1)}};var r=o.decode(e.substr(1));return"blob"===t&&g&&(r=new g([r])),{type:n,data:r}},h.encodePayload=function(e,t,n){"function"==typeof t&&(n=t,t=null);var r=i(e);if(t&&r)return g&&!f?h.encodePayloadAsBlob(e,n):h.encodePayloadAsArrayBuffer(e,n);if(!e.length)return n("0:");y(e,function(e,n){h.encodePacket(e,!!r&&t,!1,function(e){var t;n(null,(t=e).length+":"+t)})},function(e,t){return n(t.join(""))})},h.decodePayload=function(e,t,n){if("string"!=typeof e)return h.decodePayloadAsBinary(e,t,n);var r;if("function"==typeof t&&(n=t,t=null),""===e)return n(d,0,1);for(var o,i,s="",a=0,c=e.length;a<c;a++){var u=e.charAt(a);if(":"===u){if(""===s||s!=(o=Number(s)))return n(d,0,1);if(s!=(i=e.substr(a+1,o)).length)return n(d,0,1);if(i.length){if(r=h.decodePacket(i,t,!1),d.type===r.type&&d.data===r.data)return n(d,0,1);if(!1===n(r,a+o,c))return}a+=o,s=""}else s+=u}return""!==s?n(d,0,1):void 0},h.encodePayloadAsArrayBuffer=function(e,r){if(!e.length)return r(new ArrayBuffer(0));y(e,function(e,t){h.encodePacket(e,!0,!0,function(e){return t(null,e)})},function(e,t){var n=t.reduce(function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2},0),s=new Uint8Array(n),a=0;return t.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),o=0;o<e.length;o++)r[o]=e.charCodeAt(o);n=r.buffer}s[a++]=t?0:1;var i=n.byteLength.toString();for(o=0;o<i.length;o++)s[a++]=parseInt(i[o]);s[a++]=255;for(r=new Uint8Array(n),o=0;o<r.length;o++)s[a++]=r[o]}),r(s.buffer)})},h.encodePayloadAsBlob=function(e,n){y(e,function(e,a){h.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);e=n.buffer,t[0]=0}var o=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),i=new Uint8Array(o.length+1);for(r=0;r<o.length;r++)i[r]=parseInt(o[r]);if(i[o.length]=255,g){var s=new g([t.buffer,i.buffer,e]);a(null,s)}})},function(e,t){return n(new g(t))})},h.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var t=e,o=[];0<t.byteLength;){for(var i=new Uint8Array(t),s=0===i[0],a="",c=1;255!==i[c];c++){if(310<a.length)return r(d,0,1);a+=i[c]}t=p(t,2+a.length),a=parseInt(a);var u=p(t,0,a);if(s)try{u=String.fromCharCode.apply(null,new Uint8Array(u))}catch(e){var f=new Uint8Array(u);u="";for(c=0;c<f.length;c++)u+=String.fromCharCode(f[c])}o.push(u),t=p(t,a)}var l=o.length;o.forEach(function(e,t){r(h.decodePacket(e,n,!0),t,l)})}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";var r=n(21),o=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=l;var i=n(14);i.inherits=n(10);var s=n(40),a=n(43);i.inherits(l,s);for(var c=o(a.prototype),u=0;u<c.length;u++){var f=c[u];l.prototype[f]||(l.prototype[f]=a.prototype[f])}function l(e){if(!(this instanceof l))return new l(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||r.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),l.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,M,t){"use strict";(function(e){var r=t(71),i=t(72),s=t(32);function n(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(n()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,n){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,n);if("number"!=typeof e)return o(this,e,t,n);if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}function o(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=f(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!l.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),o=(e=a(e,r)).write(t,n);o!==r&&(e=e.slice(0,o));return e}(e,t,n):function(e,t){if(l.isBuffer(t)){var n=0|h(t.length);return 0===(e=a(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):f(e,t);if("Buffer"===t.type&&s(t.data))return f(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t){if(c(t),e=a(e,t<0?0:0|h(t)),!l.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|h(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function h(e){if(e>=n())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n().toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return N(e).length;default:if(r)return B(e).length;t=(""+t).toLowerCase(),r=!0}}function d(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,o){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):2147483647<n?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=l.from(t,r)),l.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,o);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,o);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,o){var i,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a/=s=2,c/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){var f=-1;for(i=n;i<a;i++)if(u(e,i)===u(t,-1===f?0:i-f)){if(-1===f&&(f=i),i-f+1===c)return f*s}else-1!==f&&(i-=i-f),f=-1}else for(a<n+c&&(n=a-c),i=n;0<=i;i--){for(var l=!0,h=0;h<c;h++)if(u(e,i+h)!==u(t,h)){l=!1;break}if(l)return i}return-1}function v(e,t,n,r){n=Number(n)||0;var o=e.length-n;r?o<(r=Number(r))&&(r=o):r=o;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");i/2<r&&(r=i/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function m(e,t,n,r){return D(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function b(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function w(e,t,n){n=Math.min(e.length,n);for(var r=[],o=t;o<n;){var i,s,a,c,u=e[o],f=null,l=239<u?4:223<u?3:191<u?2:1;if(o+l<=n)switch(l){case 1:u<128&&(f=u);break;case 2:128==(192&(i=e[o+1]))&&127<(c=(31&u)<<6|63&i)&&(f=c);break;case 3:i=e[o+1],s=e[o+2],128==(192&i)&&128==(192&s)&&2047<(c=(15&u)<<12|(63&i)<<6|63&s)&&(c<55296||57343<c)&&(f=c);break;case 4:i=e[o+1],s=e[o+2],a=e[o+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&65535<(c=(15&u)<<18|(63&i)<<12|(63&s)<<6|63&a)&&c<1114112&&(f=c)}null===f?(f=65533,l=1):65535<f&&(f-=65536,r.push(f>>>10&1023|55296),f=56320|1023&f),r.push(f),o+=l}return function(e){var t=e.length;if(t<=_)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=_));return n}(r)}M.Buffer=l,M.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},M.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),M.kMaxLength=n(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,n){return o(null,e,t,n)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,n){return r=null,i=t,s=n,c(o=e),o<=0?a(r,o):void 0!==i?"string"==typeof s?a(r,o).fill(i,s):a(r,o).fill(i):a(r,o);var r,o,i,s},l.allocUnsafe=function(e){return u(null,e)},l.allocUnsafeSlow=function(e){return u(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,o=0,i=Math.min(n,r);o<i;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var n;if(void 0===t)for(n=t=0;n<e.length;++n)t+=e[n].length;var r=l.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var i=e[n];if(!l.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(r,o),o+=i.length}return r},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)d(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)d(this,t,t+3),d(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)d(this,t,t+7),d(this,t+1,t+6),d(this,t+2,t+5),d(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?w(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return E(this,t,n);case"utf8":case"utf-8":return w(this,t,n);case"ascii":return C(this,t,n);case"latin1":case"binary":return k(this,t,n);case"base64":return b(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",t=M.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,n,r,o){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),t<0||n>e.length||r<0||o>this.length)throw new RangeError("out of range index");if(o<=r&&n<=t)return 0;if(o<=r)return-1;if(n<=t)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(i,s),c=this.slice(r,o),u=e.slice(t,n),f=0;f<a;++f)if(c[f]!==u[f]){i=c[f],s=u[f];break}return i<s?-1:s<i?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},l.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-t;if((void 0===n||o<n)&&(n=o),0<e.length&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i,s,a,c,u,f,l,h,p,d=!1;;)switch(r){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return h=t,p=n,D(B(e,(l=this).length-h),l,h,p);case"ascii":return m(this,e,t,n);case"latin1":case"binary":return m(this,e,t,n);case"base64":return c=this,u=t,f=n,D(N(e),c,u,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return s=t,a=n,D(function(e,t){for(var n,r,o,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,o=n%256,i.push(o),i.push(r);return i}(e,(i=this).length-s),i,s,a);default:if(d)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),d=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var _=4096;function C(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(127&e[o]);return r}function k(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(e[o]);return r}function E(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||r<n)&&(n=r);for(var o="",i=t;i<n;++i)o+=j(e[i]);return o}function O(e,t,n){for(var r=e.slice(t,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function R(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(n<e+t)throw new RangeError("Trying to access beyond buffer length")}function S(e,t,n,r,o,i){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(o<t||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function F(e,t,n,r){t<0&&(t=65535+t+1);for(var o=0,i=Math.min(e.length-n,2);o<i;++o)e[n+o]=(t&255<<8*(r?o:1-o))>>>8*(r?o:1-o)}function A(e,t,n,r){t<0&&(t=4294967295+t+1);for(var o=0,i=Math.min(e.length-n,4);o<i;++o)e[n+o]=t>>>8*(r?o:3-o)&255}function T(e,t,n,r,o,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function I(e,t,n,r,o){return o||T(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function x(e,t,n,r,o){return o||T(e,0,n,8),i.write(e,t,n,r,52,8),n+8}l.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=l.prototype;else{var o=t-e;n=new l(o,void 0);for(var i=0;i<o;++i)n[i]=this[i+e]}return n},l.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r},l.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var r=this[e+--t],o=1;0<t&&(o*=256);)r+=this[e+--t]*o;return r},l.prototype.readUInt8=function(e,t){return t||R(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||R(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||R(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return(o*=128)<=r&&(r-=Math.pow(2,8*t)),r},l.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var r=t,o=1,i=this[e+--r];0<r&&(o*=256);)i+=this[e+--r]*o;return(o*=128)<=i&&(i-=Math.pow(2,8*t)),i},l.prototype.readInt8=function(e,t){return t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||R(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){t||R(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||R(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||R(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||R(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||R(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||S(this,e,t,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[t]=255&e;++i<n&&(o*=256);)this[t+i]=e/o&255;return t+n},l.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||S(this,e,t,n,Math.pow(2,8*n)-1,0);var o=n-1,i=1;for(this[t+o]=255&e;0<=--o&&(i*=256);)this[t+o]=e/i&255;return t+n},l.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):F(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):F(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):A(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):A(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var o=Math.pow(2,8*n-1);S(this,e,t,n,o-1,-o)}var i=0,s=1,a=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},l.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var o=Math.pow(2,8*n-1);S(this,e,t,n,o-1,-o)}var i=n-1,s=1,a=0;for(this[t+i]=255&e;0<=--i&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):F(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):F(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):A(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):A(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,n){return I(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return I(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return x(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return x(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),0<r&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var o,i=r-n;if(this===e&&n<t&&t<r)for(o=i-1;0<=o;--o)e[o+t]=this[o+n];else if(i<1e3||!l.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},l.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var s=l.isBuffer(e)?e:B(new l(e,r).toString()),a=s.length;for(i=0;i<n-t;++i)this[i+t]=s[i%a]}return this};var P=/[^+\/0-9A-Za-z-_]/g;function j(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var n;t=t||1/0;for(var r=e.length,o=null,i=[],s=0;s<r;++s){if(55295<(n=e.charCodeAt(s))&&n<57344){if(!o){if(56319<n){-1<(t-=3)&&i.push(239,191,189);continue}if(s+1===r){-1<(t-=3)&&i.push(239,191,189);continue}o=n;continue}if(n<56320){-1<(t-=3)&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&-1<(t-=3)&&i.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function N(e){return r.toByteArray(function(e){var t;if((e=(t=e,t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(P,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function D(e,t,n,r){for(var o=0;o<r&&!(o+n>=t.length||o>=e.length);++o)t[o+n]=e[o];return o}}).call(this,t(0))},function(e,t,n){var r=n(12),o=r.Buffer;function i(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return o(e,t,n)}o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?e.exports=r:(i(r,t),t.Buffer=s),i(o,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return o(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=o(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,r,t){(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){return Object.prototype.toString.call(e)}r.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},r.isBoolean=function(e){return"boolean"==typeof e},r.isNull=function(e){return null===e},r.isNullOrUndefined=function(e){return null==e},r.isNumber=function(e){return"number"==typeof e},r.isString=function(e){return"string"==typeof e},r.isSymbol=function(e){return"symbol"===t(e)},r.isUndefined=function(e){return void 0===e},r.isRegExp=function(e){return"[object RegExp]"===n(e)},r.isObject=function(e){return"object"===t(e)&&null!==e},r.isDate=function(e){return"[object Date]"===n(e)},r.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},r.isFunction=function(e){return"function"==typeof e},r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===t(e)||void 0===e},r.isBuffer=e.isBuffer}).call(this,t(12).Buffer)},function(e,Ue,t){(function(e,t){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r="__lodash_hash_undefined__",o=9007199254740991,n="[object Arguments]",i="[object AsyncFunction]",s="[object Function]",c="[object GeneratorFunction]",u="[object Null]",C="[object Object]",f="[object Proxy]",l="[object Undefined]",h=/^\[object .+?Constructor\]$/,p=/^(?:0|[1-9]\d*)$/,d={};d["[object Float32Array]"]=d["[object Float64Array]"]=d["[object Int8Array]"]=d["[object Int16Array]"]=d["[object Int32Array]"]=d["[object Uint8Array]"]=d["[object Uint8ClampedArray]"]=d["[object Uint16Array]"]=d["[object Uint32Array]"]=!0,d[n]=d["[object Array]"]=d["[object ArrayBuffer]"]=d["[object Boolean]"]=d["[object DataView]"]=d["[object Date]"]=d["[object Error]"]=d[s]=d["[object Map]"]=d["[object Number]"]=d[C]=d["[object RegExp]"]=d["[object Set]"]=d["[object String]"]=d["[object WeakMap]"]=!1;var g="object"==(void 0===e?"undefined":a(e))&&e&&e.Object===Object&&e,y="object"==("undefined"==typeof self?"undefined":a(self))&&self&&self.Object===Object&&self,v=g||y||Function("return this")(),m="object"==a(Ue)&&Ue&&!Ue.nodeType&&Ue,b=m&&"object"==a(t)&&t&&!t.nodeType&&t,w=b&&b.exports===m,_=w&&g.process,k=function(){try{return _&&_.binding&&_.binding("util")}catch(e){}}(),E=k&&k.isTypedArray;function O(e,t){return"__proto__"==t?void 0:e[t]}var R,S,F,A=Array.prototype,T=Function.prototype,I=Object.prototype,x=v["__core-js_shared__"],P=T.toString,j=I.hasOwnProperty,B=(R=/[^.]+$/.exec(x&&x.keys&&x.keys.IE_PROTO||""))?"Symbol(src)_1."+R:"",N=I.toString,D=P.call(Object),M=RegExp("^"+P.call(j).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),L=w?v.Buffer:void 0,U=v.Symbol,q=v.Uint8Array,W=L?L.allocUnsafe:void 0,z=(S=Object.getPrototypeOf,F=Object,function(e){return S(F(e))}),V=Object.create,Y=I.propertyIsEnumerable,G=A.splice,H=U?U.toStringTag:void 0,$=function(){try{var e=me(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),X=L?L.isBuffer:void 0,J=Math.max,K=Date.now,Z=me(v,"Map"),Q=me(Object,"create"),ee=function(){function n(){}return function(e){if(!xe(e))return{};if(V)return V(e);n.prototype=e;var t=new n;return n.prototype=void 0,t}}();function te(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ne(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function re(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function oe(e){var t=this.__data__=new ne(e);this.size=t.size}function ie(e,t){var n=Se(e),r=!n&&Re(e),o=!n&&!r&&Ae(e),i=!n&&!r&&!o&&Be(e),s=n||r||o||i,a=s?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],c=a.length;for(var u in e)!t&&!j.call(e,u)||s&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||be(u,c))||a.push(u);return a}function se(e,t,n){(void 0===n||Oe(e[t],n))&&(void 0!==n||t in e)||ce(e,t,n)}function ae(e,t){for(var n=e.length;n--;)if(Oe(e[n][0],t))return n;return-1}function ce(e,t,n){"__proto__"==t&&$?$(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}te.prototype.clear=function(){this.__data__=Q?Q(null):{},this.size=0},te.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},te.prototype.get=function(e){var t=this.__data__;if(Q){var n=t[e];return n===r?void 0:n}return j.call(t,e)?t[e]:void 0},te.prototype.has=function(e){var t=this.__data__;return Q?void 0!==t[e]:j.call(t,e)},te.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Q&&void 0===t?r:t,this},ne.prototype.clear=function(){this.__data__=[],this.size=0},ne.prototype.delete=function(e){var t=this.__data__,n=ae(t,e);return!(n<0||(n==t.length-1?t.pop():G.call(t,n,1),--this.size,0))},ne.prototype.get=function(e){var t=this.__data__,n=ae(t,e);return n<0?void 0:t[n][1]},ne.prototype.has=function(e){return-1<ae(this.__data__,e)},ne.prototype.set=function(e,t){var n=this.__data__,r=ae(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},re.prototype.clear=function(){this.size=0,this.__data__={hash:new te,map:new(Z||ne),string:new te}},re.prototype.delete=function(e){var t=ve(this,e).delete(e);return this.size-=t?1:0,t},re.prototype.get=function(e){return ve(this,e).get(e)},re.prototype.has=function(e){return ve(this,e).has(e)},re.prototype.set=function(e,t){var n=ve(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},oe.prototype.clear=function(){this.__data__=new ne,this.size=0},oe.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},oe.prototype.get=function(e){return this.__data__.get(e)},oe.prototype.has=function(e){return this.__data__.has(e)},oe.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ne){var r=n.__data__;if(!Z||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new re(r)}return n.set(e,t),this.size=n.size,this};var ue,fe=function(e,t,n){for(var r=-1,o=Object(e),i=n(e),s=i.length;s--;){var a=i[ue?s:++r];if(!1===t(o[a],a,o))break}return e};function le(e){return null==e?void 0===e?l:u:H&&H in Object(e)?function(e){var t=j.call(e,H),n=e[H];try{var r=!(e[H]=void 0)}catch(e){}var o=N.call(e);r&&(t?e[H]=n:delete e[H]);return o}(e):(t=e,N.call(t));var t}function he(e){return Pe(e)&&le(e)==n}function pe(e){return!(!xe(e)||(t=e,B&&B in t))&&(Te(e)?M:h).test(function(e){if(null!=e){try{return P.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}function de(e){if(!xe(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=we(e),n=[];for(var r in e)("constructor"!=r||!t&&j.call(e,r))&&n.push(r);return n}function ge(r,o,i,s,a){r!==o&&fe(o,function(e,t){if(xe(e))a||(a=new oe),function(e,t,n,r,o,i,s){var a=O(e,n),c=O(t,n),u=s.get(c);if(u)return se(e,n,u);var f=i?i(a,c,n+"",e,t,s):void 0,l=void 0===f;if(l){var h=Se(c),p=!h&&Ae(c),d=!h&&!p&&Be(c);f=c,h||p||d?f=Se(a)?a:Pe(_=a)&&Fe(_)?function(e,t){var n=-1,r=e.length;t||(t=Array(r));for(;++n<r;)t[n]=e[n];return t}(a):p?function(e,t){if(t)return e.slice();var n=e.length,r=W?W(n):new e.constructor(n);return e.copy(r),r}(c,!(l=!1)):d?(v=c,m=!(l=!1)?(b=v.buffer,w=new b.constructor(b.byteLength),new q(w).set(new q(b)),w):v.buffer,new v.constructor(m,v.byteOffset,v.length)):[]:function(e){if(!Pe(e)||le(e)!=C)return!1;var t=z(e);if(null===t)return!0;var n=j.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&P.call(n)==D}(c)||Re(c)?Re(f=a)?f=function(e,t,n,r){var o=!n;n||(n={});for(var i,s,a,c,u=-1,f=t.length;++u<f;){var l=t[u],h=r?r(n[l],e[l],l,n,e):void 0;void 0===h&&(h=e[l]),o?ce(n,l,h):(a=h,c=(i=n)[s=l],j.call(i,s)&&Oe(c,a)&&(void 0!==a||s in i)||ce(i,s,a))}return n}(y=a,Ne(y)):(!xe(a)||r&&Te(a))&&(f="function"!=typeof(g=c).constructor||we(g)?{}:ee(z(g))):l=!1}var g;var y;var v,m,b,w;var _;l&&(s.set(c,f),o(f,c,r,i,s),s.delete(c));se(e,n,f)}(r,o,t,i,ge,s,a);else{var n=s?s(O(r,t),e,t+"",r,o,a):void 0;void 0===n&&(n=e),se(r,t,n)}},Ne)}function ye(e,t){return Ee((i=e,a=Le,s=J(void 0===(s=t)?i.length-1:s,0),function(){for(var e=arguments,t=-1,n=J(e.length-s,0),r=Array(n);++t<n;)r[t]=e[s+t];t=-1;for(var o=Array(s+1);++t<s;)o[t]=e[t];return o[s]=a(r),function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}(i,this,o)}),e+"");var i,s,a}function ve(e,t){var n,r,o=e.__data__;return("string"==(r=a(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof t?"string":"hash"]:o.map}function me(e,t){var n,r,o=(r=t,null==(n=e)?void 0:n[r]);return pe(o)?o:void 0}function be(e,t){var n=a(e);return!!(t=null==t?o:t)&&("number"==n||"symbol"!=n&&p.test(e))&&-1<e&&e%1==0&&e<t}function we(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||I)}var _e,Ce,ke,Ee=(_e=$?function(e,t){return $(e,"toString",{configurable:!0,enumerable:!1,value:(n=t,function(){return n}),writable:!0});var n}:Le,ke=Ce=0,function(){var e=K(),t=16-(e-ke);if(ke=e,0<t){if(800<=++Ce)return arguments[0]}else Ce=0;return _e.apply(void 0,arguments)});function Oe(e,t){return e===t||e!=e&&t!=t}var Re=he(function(){return arguments}())?he:function(e){return Pe(e)&&j.call(e,"callee")&&!Y.call(e,"callee")},Se=Array.isArray;function Fe(e){return null!=e&&Ie(e.length)&&!Te(e)}var Ae=X||function(){return!1};function Te(e){if(!xe(e))return!1;var t=le(e);return t==s||t==c||t==i||t==f}function Ie(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=o}function xe(e){var t=a(e);return null!=e&&("object"==t||"function"==t)}function Pe(e){return null!=e&&"object"==a(e)}var je,Be=E?(je=E,function(e){return je(e)}):function(e){return Pe(e)&&Ie(e.length)&&!!d[le(e)]};function Ne(e){return Fe(e)?ie(e,!0):de(e)}var De,Me=(De=function(e,t,n){ge(e,t,n)},ye(function(e,t){var n=-1,r=t.length,o=1<r?t[r-1]:void 0,i=2<r?t[2]:void 0;for(o=3<De.length&&"function"==typeof o?(r--,o):void 0,i&&function(e,t,n){if(!xe(n))return!1;var r=a(t);return!!("number"==r?Fe(n)&&be(t,n.length):"string"==r&&t in n)&&Oe(n[t],e)}(t[0],t[1],i)&&(o=r<3?void 0:o,r=1),e=Object(e);++n<r;){var s=t[n];s&&De(e,s,n,o)}return e}));function Le(e){return e}t.exports=Me}).call(this,t(0),t(48)(e))},function(e,t,n){e.exports={nyi:n(49),peerNotFound:n(50),notHandled:n(51)}},function(r,i,o){(function(t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function e(){var e;try{e=i.storage.debug}catch(e){}return!e&&void 0!==t&&"env"in t&&(e=t.env.DEBUG),e}(i=r.exports=o(60)).log=function(){return"object"===("undefined"==typeof console?"undefined":n(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},i.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+i.humanize(this.diff),!t)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var r=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(r++,"%c"===e&&(o=r))}),e.splice(o,0,n)},i.save=function(e){try{null==e?i.storage.removeItem("debug"):i.storage.debug=e}catch(e){}},i.load=e,i.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},i.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),i.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],i.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},i.enable(e())}).call(this,o(1))},function(e,t){t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),r=0,o=n.length;r<o;r++){var i=n[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},function(e,t){e.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(r,i,o){(function(t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function e(){var e;try{e=i.storage.debug}catch(e){}return!e&&void 0!==t&&"env"in t&&(e=t.env.DEBUG),e}(i=r.exports=o(79)).log=function(){return"object"===("undefined"==typeof console?"undefined":n(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},i.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+i.humanize(this.diff),!t)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var r=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(r++,"%c"===e&&(o=r))}),e.splice(o,0,n)},i.save=function(e){try{null==e?i.storage.removeItem("debug"):i.storage.debug=e}catch(e){}},i.load=e,i.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},i.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),i.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],i.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},i.enable(e())}).call(this,o(1))},function(e,t,n){"use strict";(function(a){!a.version||0===a.version.indexOf("v0.")||0===a.version.indexOf("v1.")&&0!==a.version.indexOf("v1.8.")?e.exports={nextTick:function(e,t,n,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,i,s=arguments.length;switch(s){case 0:case 1:return a.nextTick(e);case 2:return a.nextTick(function(){e.call(null,t)});case 3:return a.nextTick(function(){e.call(null,t,n)});case 4:return a.nextTick(function(){e.call(null,t,n,r)});default:for(o=new Array(s-1),i=0;i<o.length;)o[i++]=arguments[i];return a.nextTick(function(){e.apply(null,o)})}}}:e.exports=a}).call(this,n(1))},function(e,c,t){var u=t(62)("socket.io-parser"),n=t(8),i=t(65),f=t(26),r=t(27);function o(){}c.protocol=4,c.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],c.CONNECT=0,c.DISCONNECT=1,c.EVENT=2,c.ACK=3,c.ERROR=4,c.BINARY_EVENT=5,c.BINARY_ACK=6,c.Encoder=o,c.Decoder=l;var s=c.ERROR+'"encode error"';function a(e){var t=""+e.type;if(c.BINARY_EVENT!==e.type&&c.BINARY_ACK!==e.type||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data){var n=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===n)return s;t+=n}return u("encoded %j as %s",e,t),t}function l(){this.reconstructor=null}function h(e){this.reconPack=e,this.buffers=[]}function p(e){return{type:c.ERROR,data:"parser error: "+e}}o.prototype.encode=function(e,t){var n,o;(u("encoding packet %j",e),c.BINARY_EVENT===e.type||c.BINARY_ACK===e.type)?(n=e,o=t,i.removeBlobs(n,function(e){var t=i.deconstructPacket(e),n=a(t.packet),r=t.buffers;r.unshift(n),o(r)})):t([a(e)])},n(l.prototype),l.prototype.add=function(e){var t;if("string"==typeof e)t=function(e){var t=0,n={type:Number(e.charAt(0))};if(null==c.types[n.type])return p("unknown packet type "+n.type);if(c.BINARY_EVENT===n.type||c.BINARY_ACK===n.type){for(var r="";"-"!==e.charAt(++t)&&(r+=e.charAt(t),t!=e.length););if(r!=Number(r)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(r)}if("/"===e.charAt(t+1))for(n.nsp="";++t;){var o=e.charAt(t);if(","===o)break;if(n.nsp+=o,t===e.length)break}else n.nsp="/";var i=e.charAt(t+1);if(""!==i&&Number(i)==i){for(n.id="";++t;){var o=e.charAt(t);if(null==o||Number(o)!=o){--t;break}if(n.id+=e.charAt(t),t===e.length)break}n.id=Number(n.id)}if(e.charAt(++t)){var s=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(t)),a=!1!==s&&(n.type===c.ERROR||f(s));if(!a)return p("invalid payload");n.data=s}return u("decoded %s as %j",e,n),n}(e),c.BINARY_EVENT===t.type||c.BINARY_ACK===t.type?(this.reconstructor=new h(t),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!r(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",t))}},l.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},h.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length!==this.reconPack.attachments)return null;var t=i.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t},h.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,n){(function(o){var i=n(68);e.exports=function(e){var t=e.xdomain,n=e.xscheme,r=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||i))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(e){}if(!t)try{return new(o[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}).call(this,n(0))},function(e,t,n){var r=n(9);function o(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}n(8)((e.exports=o).prototype),o.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},o.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(e){var t=r.decodePacket(e,this.socket.binaryType);this.onPacket(t)},o.prototype.onPacket=function(e){this.emit("packet",e)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t){var a=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,c=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));for(var o=a.exec(e||""),i={},s=14;s--;)i[c[s]]=o[s]||"";return-1!=n&&-1!=r&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){(function(t){e.exports=function(e){return n&&t.Buffer.isBuffer(e)||r&&(e instanceof t.ArrayBuffer||o(e))};var n="function"==typeof t.Buffer&&"function"==typeof t.Buffer.isBuffer,r="function"==typeof t.ArrayBuffer,o=r&&"function"==typeof t.ArrayBuffer.isView?t.ArrayBuffer.isView:function(e){return e.buffer instanceof t.ArrayBuffer}}).call(this,n(0))},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var c=n(66),i=n(35),o=n(8),s=n(22),u=n(36),a=n(37),f=n(17)("socket.io-client:manager"),l=n(34),h=n(85),p=Object.prototype.hasOwnProperty;function d(e,t){if(!(this instanceof d))return new d(e,t);e&&"object"===r(e)&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||s;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}(e.exports=d).prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)p.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},d.prototype.updateSocketIds=function(){for(var e in this.nsps)p.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},d.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},o(d.prototype),d.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},d.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},d.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},d.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},d.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},d.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},d.prototype.open=d.prototype.connect=function(n,e){if(f("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;f("opening %s",this.uri),this.engine=c(this.uri,this.opts);var t=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var o=u(t,"open",function(){r.onopen(),n&&n()}),i=u(t,"error",function(e){if(f("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",e),n){var t=new Error("Connection error");t.data=e,n(t)}else r.maybeReconnectOnOpen()});if(!1!==this._timeout){var s=this._timeout;f("connect attempt will timeout after %d",s);var a=setTimeout(function(){f("connect attempt timed out after %d",s),o.destroy(),t.close(),t.emit("error","timeout"),r.emitAll("connect_timeout",s)},s);this.subs.push({destroy:function(){clearTimeout(a)}})}return this.subs.push(o),this.subs.push(i),this},d.prototype.onopen=function(){f("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(u(e,"data",a(this,"ondata"))),this.subs.push(u(e,"ping",a(this,"onping"))),this.subs.push(u(e,"pong",a(this,"onpong"))),this.subs.push(u(e,"error",a(this,"onerror"))),this.subs.push(u(e,"close",a(this,"onclose"))),this.subs.push(u(this.decoder,"decoded",a(this,"ondecoded")))},d.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},d.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},d.prototype.ondata=function(e){this.decoder.add(e)},d.prototype.ondecoded=function(e){this.emit("packet",e)},d.prototype.onerror=function(e){f("error",e),this.emitAll("error",e)},d.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new i(this,e,t),this.nsps[e]=n;var r=this;n.on("connecting",o),n.on("connect",function(){n.id=r.generateId(e)}),this.autoConnect&&o()}function o(){~l(r.connecting,n)||r.connecting.push(n)}return n},d.prototype.destroy=function(e){var t=l(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},d.prototype.packet=function(n){f("writing packet %j",n);var r=this;n.query&&0===n.type&&(n.nsp+="?"+n.query),r.encoding?r.packetBuffer.push(n):(r.encoding=!0,this.encoder.encode(n,function(e){for(var t=0;t<e.length;t++)r.engine.write(e[t],n.options);r.encoding=!1,r.processPacketQueue()}))},d.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},d.prototype.cleanup=function(){f("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},d.prototype.close=d.prototype.disconnect=function(){f("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},d.prototype.onclose=function(e){f("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)f("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();f("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout(function(){t.skipReconnect||(f("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(f("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(f("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(n)}})}},d.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,n){(function(s){var a=n(23),c=n(69),u=n(81),e=n(82);t.polling=function(e){var t=!1,n=!1,r=!1!==e.jsonp;if(s.location){var o="https:"===location.protocol,i=location.port;i||(i=o?443:80),t=e.hostname!==location.hostname||i!==e.port,n=e.secure!==o}{if(e.xdomain=t,e.xscheme=n,"open"in new a(e)&&!e.forceJSONP)return new c(e);if(!r)throw new Error("JSONP disabled");return new u(e)}},t.websocket=e}).call(this,n(0))},function(e,t,n){var r=n(24),o=n(18),i=n(9),s=n(19),a=n(33),c=n(20)("engine.io-client:polling");e.exports=f;var u=null!=new(n(23))({xdomain:!1}).responseType;function f(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),r.call(this,e)}s(f,r),f.prototype.name="polling",f.prototype.doOpen=function(){this.poll()},f.prototype.pause=function(e){var t=this;function n(){c("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(c("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){c("pre-pause polling complete"),--r||n()})),this.writable||(c("we are currently writing - waiting to pause"),r++,this.once("drain",function(){c("pre-pause writing complete"),--r||n()}))}else n()},f.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},f.prototype.onData=function(e){var r=this;c("polling got data %s",e);i.decodePayload(e,this.socket.binaryType,function(e,t,n){if("opening"===r.readyState&&r.onOpen(),"close"===e.type)return r.onClose(),!1;r.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},f.prototype.doClose=function(){var e=this;function t(){c("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),t()):(c("transport not open - deferring close"),this.once("open",t))},f.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};i.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},f.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=a()),this.supportsBinary||e.sid||(e.b64=1),e=o.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},function(t,e,n){(function(i){function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=n(73),e=Object.prototype.toString,c="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===e.call(Blob),u="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===e.call(File);t.exports=function e(t){if(!t||"object"!==s(t))return!1;if(a(t)){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return!0;return!1}if("function"==typeof i&&i.isBuffer&&i.isBuffer(t)||"function"==typeof ArrayBuffer&&t instanceof ArrayBuffer||c&&t instanceof Blob||u&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)&&e(t[o]))return!0;return!1}}).call(this,n(12).Buffer)},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";var r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i=64,s={},a=0,c=0;function u(e){for(var t="";t=o[e%i]+t,0<(e=Math.floor(e/i)););return t}function f(){var e=u(+new Date);return e!==r?(a=0,r=e):e+"."+u(a++)}for(;c<i;c++)s[o[c]]=c;f.encode=u,f.decode=function(e){var t=0;for(c=0;c<e.length;c++)t=t*i+s[e.charAt(c)];return t},e.exports=f},function(e,t){var r=[].indexOf;e.exports=function(e,t){if(r)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=n(22),i=n(8),s=n(84),a=n(36),c=n(37),u=n(17)("socket.io-client:socket"),f=n(18),l=n(31);e.exports=d;var h={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},p=i.prototype.emit;function d(e,t,n){this.io=e,this.nsp=t,(this.json=this).ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}i(d.prototype),d.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[a(e,"open",c(this,"onopen")),a(e,"packet",c(this,"onpacket")),a(e,"close",c(this,"onclose"))]}},d.prototype.open=d.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},d.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},d.prototype.emit=function(e){if(h.hasOwnProperty(e))return p.apply(this,arguments),this;var t=s(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:l(t))?o.BINARY_EVENT:o.EVENT,data:t,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(u("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},d.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},d.prototype.onopen=function(){if(u("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"===r(this.query)?f.encode(this.query):this.query;u("sending connect packet with query %s",e),this.packet({type:o.CONNECT,query:e})}else this.packet({type:o.CONNECT})},d.prototype.onclose=function(e){u("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},d.prototype.onpacket=function(e){var t=e.nsp===this.nsp,n=e.type===o.ERROR&&"/"===e.nsp;if(t||n)switch(e.type){case o.CONNECT:this.onconnect();break;case o.EVENT:case o.BINARY_EVENT:this.onevent(e);break;case o.ACK:case o.BINARY_ACK:this.onack(e);break;case o.DISCONNECT:this.ondisconnect();break;case o.ERROR:this.emit("error",e.data)}},d.prototype.onevent=function(e){var t=e.data||[];u("emitting event %j",t),null!=e.id&&(u("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?p.apply(this,t):this.receiveBuffer.push(t)},d.prototype.ack=function(t){var n=this,r=!1;return function(){if(!r){r=!0;var e=s(arguments);u("sending ack %j",e),n.packet({type:l(e)?o.BINARY_ACK:o.ACK,id:t,data:e})}}},d.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(u("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):u("bad ack %s",e.id)},d.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},d.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)p.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},d.prototype.ondisconnect=function(){u("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},d.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},d.prototype.close=d.prototype.disconnect=function(){return this.connected&&(u("performing disconnect (%s)",this.nsp),this.packet({type:o.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},d.prototype.compress=function(e){return this.flags.compress=e,this},d.prototype.binary=function(e){return this.flags.binary=e,this}},function(e,t){e.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},function(e,t){var r=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return t.apply(e,n.concat(r.call(arguments)))}}},function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=36e5,i=864e5;function s(e,t,n,r){var o=1.5*n<=t;return Math.round(e/n)+" "+r+(o?"s":"")}e.exports=function(e,t){t=t||{};var n=r(e);if("string"===n&&0<e.length)return function(e){if(100<(e=String(e)).length)return;var t=/^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"weeks":case"week":case"w":return 6048e5*n;case"days":case"day":case"d":return n*i;case"hours":case"hour":case"hrs":case"hr":case"h":return n*o;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*n;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&!1===isNaN(e))return t.long?function(e){var t=Math.abs(e);if(i<=t)return s(e,t,i,"day");if(o<=t)return s(e,t,o,"hour");if(6e4<=t)return s(e,t,6e4,"minute");if(1e3<=t)return s(e,t,1e3,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(i<=t)return Math.round(e/i)+"d";if(o<=t)return Math.round(e/o)+"h";if(6e4<=t)return Math.round(e/6e4)+"m";if(1e3<=t)return Math.round(e/1e3)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,c){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function f(a){return function(){var e=this,s=arguments;return new Promise(function(t,n){var r=a.apply(e,s);function o(e){u(r,t,n,o,i,"next",e)}function i(e){u(r,t,n,o,i,"throw",e)}o(void 0)})}}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=c(16),y=c(3),v=c(6),m=c(94),b=c(15),w=c(4)(),r=function(e){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=h(this,p(n).call(this))).socketId=w.new(),e._debug=c(2)("n2n:socket"),e._debugMessage=c(2)("n2n:message"),e.options=b({chunks:16e3,timeout:5e3},t),e.status="disconnected",e.on(y.socket.RECEIVE_OFFER,e.receiveOffer),e.buffer=[],e.statistics={offerSent:0,offerReceived:0},e._errored=!1,e._errors=[],e._offers={emitted:[],received:[]},e}var t,r,o,i,s,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(n,v),t=n,(r=[{key:"reviewBuffer",value:function(){for(var e;e=this.buffer.shift();)this.send(e)}},{key:"signalConnect",value:function(){this.status="connected",this.emit("connect"),this.reviewBuffer()}},{key:"signalDisconnect",value:function(){this.status="disconnected",this.emit("close",this.socketId)}},{key:"_receiveOffer",value:function(e){throw g.nyi()}},{key:"receiveOffer",value:function(e){this._offers.received.push(e),this._receiveOffer(e)}},{key:"emitOffer",value:function(e){e.sid=this.socketId,e.stats=this.statistics.offerSent,this.statistics.offerSent++,this._debug("[socket:%s] Send an accepted offer (status=%s): ",this.socketId,this.status,e,this.statistics),"connected"===this.status?(this._debug("The socket is connected but you continue to emit offers...",e,this.status,this.__socket._channel.readyState),this.emit(y.socket.EMIT_OFFER_RENEGOCIATE,e)):this.emit(y.socket.EMIT_OFFER,e),this._offers.emitted.push(e)}},{key:"_connect",value:function(e){return Promise.reject(g.nyi())}},{key:"_send",value:function(e,t){return Promise.reject(g.nyi())}},{key:"_receiveData",value:function(e){"connecting"===this.status&&this.signalConnect(),this._debug("[socket:%s] receiving data, size=%f",this.socketId,m(e)),this.emit("data",e)}},{key:"_manageErrors",value:function(){var e;this._errored=!0;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this._errors).push.apply(e,n),this._debug.apply(this,["Error on the socket: "].concat(n)),this.emit.apply(this,["error"].concat(n))}},{key:"_disconnect",value:function(){return Promise.reject(g.nyi())}},{key:"connect",value:(a=f(regeneratorRuntime.mark(function e(){var t,n=this,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0<r.length&&void 0!==r[0]?r[0]:this.options,this.status="connecting",e.abrupt("return",this._connect(t).then(function(e){return n.signalConnect(),e}).catch(function(e){return e}));case 3:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"send",value:(s=f(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m(t),this._debug("[socket:%s] Data size sent (max allowed=%f Bytes): %f",this.socketId,this.options.chunks,r),r>this.options.chunks)return e.abrupt("return",Promise.reject(new Error("Your data is too big. Max allowed: "+this.options.chunks)));e.next=6;break;case 6:if("connected"===this.status)return e.abrupt("return",this._send(t,n));e.next=10;break;case 10:if("connecting"!==this.status){e.next=14;break}this.buffer.push(t),e.next=16;break;case 14:if(["disconnecting","disconnected"].includes(this.status))throw new Error("socket disconnected or disconnecting: status="+this.status);e.next=16;break;case 16:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"disconnect",value:(i=f(regeneratorRuntime.mark(function e(){var o,i=this,t=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=0<t.length&&void 0!==t[0]?t[0]:this.options,this.status="disconnected",e.abrupt("return",new Promise(function(t,n){var r=setTimeout(function(){"disconnected"===i.status?t():n(new Error(""))},o.timeout);setTimeout(function(){"disconnected"===i.status&&(clearTimeout(r),t())},0),i._disconnect(o).then(function(e){clearTimeout(r),i.signalDisconnect(),t(e)}).catch(function(e){clearTimeout(r),n(e)})}));case 3:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})}])&&l(t.prototype,r),o&&l(t,o),n}();e.exports=r},function(P,e,j){"use strict";(function(e,y){var v=j(21);P.exports=h;var s,m=j(32);h.ReadableState=i;j(6).EventEmitter;var b=function(e,t){return e.listeners(t).length},o=j(41),u=j(13).Buffer,f=e.Uint8Array||function(){};var t=j(14);t.inherits=j(10);var n=j(103),w=void 0;w=n&&n.debuglog?n.debuglog("stream"):function(){};var a,c=j(104),r=j(42);t.inherits(h,o);var l=["error","close","destroy","pause","resume"];function i(e,t){e=e||{};var n=t instanceof(s=s||j(11));this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,o=e.readableHighWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n&&(o||0===o)?o:i,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new c,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(a||(a=j(44).StringDecoder),this.decoder=new a(e.encoding),this.encoding=e.encoding)}function h(e){if(s=s||j(11),!(this instanceof h))return new h(e);this._readableState=new i(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),o.call(this)}function p(e,t,n,r,o){var i,s,a,c=e._readableState;null===t?(c.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,C(e)}(e,c)):(o||(i=function(e,t){var n;r=t,u.isBuffer(r)||r instanceof f||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));var r;return n}(c,t)),i?e.emit("error",i):c.objectMode||t&&0<t.length?("string"==typeof t||c.objectMode||Object.getPrototypeOf(t)===u.prototype||(s=t,t=u.from(s)),r?c.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):d(e,c,t,!0):c.ended?e.emit("error",new Error("stream.push() after EOF")):(c.reading=!1,c.decoder&&!n?(t=c.decoder.write(t),c.objectMode||0!==t.length?d(e,c,t,!1):E(e,c)):d(e,c,t,!1))):r||(c.reading=!1));return!(a=c).ended&&(a.needReadable||a.length<a.highWaterMark||0===a.length)}function d(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&C(e)),E(e,t)}Object.defineProperty(h.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),h.prototype.destroy=r.destroy,h.prototype._undestroy=r.undestroy,h.prototype._destroy=function(e,t){this.push(null),t(e)},h.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=u.from(e,t),t=""),n=!0),p(this,e,t,!1,n)},h.prototype.unshift=function(e){return p(this,e,null,!0,!1)},h.prototype.isPaused=function(){return!1===this._readableState.flowing},h.prototype.setEncoding=function(e){return a||(a=j(44).StringDecoder),this._readableState.decoder=new a(e),this._readableState.encoding=e,this};var g=8388608;function _(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=(g<=(n=e)?n=g:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var n}function C(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(w("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?v.nextTick(k,e):k(e))}function k(e){w("emit readable"),e.emit("readable"),F(e)}function E(e,t){t.readingMore||(t.readingMore=!0,v.nextTick(O,e,t))}function O(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(w("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function R(e){w("readable nexttick read 0"),e.read(0)}function S(e,t){t.reading||(w("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),F(e),t.flowing&&!t.reading&&e.read(0)}function F(e){var t=e._readableState;for(w("flow",t.flowing);t.flowing&&null!==e.read(););}function A(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,o=n.data;e-=o.length;for(;n=n.next;){var i=n.data,s=e>i.length?i.length:e;if(s===i.length?o+=i:o+=i.slice(0,e),0===(e-=s)){s===i.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n).data=i.slice(s);break}++r}return t.length-=r,o}(e,t):function(e,t){var n=u.allocUnsafe(e),r=t.head,o=1;r.data.copy(n),e-=r.data.length;for(;r=r.next;){var i=r.data,s=e>i.length?i.length:e;if(i.copy(n,n.length-e,0,s),0===(e-=s)){s===i.length?(++o,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r).data=i.slice(s);break}++o}return t.length-=o,n}(e,t);return r}(e,t.buffer,t.decoder),n);var n}function T(e){var t=e._readableState;if(0<t.length)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,v.nextTick(I,t,e))}function I(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function x(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}h.prototype.read=function(e){w("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return w("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?T(this):C(this),null;if(0===(e=_(e,t))&&t.ended)return 0===t.length&&T(this),null;var r,o=t.needReadable;return w("need readable",o),(0===t.length||t.length-e<t.highWaterMark)&&w("length less than watermark",o=!0),t.ended||t.reading?w("reading or ended",o=!1):o&&(w("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=_(n,t))),null===(r=0<e?A(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&T(this)),null!==r&&this.emit("data",r),r},h.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},h.prototype.pipe=function(n,e){var r=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=n;break;case 1:o.pipes=[o.pipes,n];break;default:o.pipes.push(n)}o.pipesCount+=1,w("pipe count=%d opts=%j",o.pipesCount,e);var t=(!e||!1!==e.end)&&n!==y.stdout&&n!==y.stderr?s:g;function i(e,t){w("onunpipe"),e===r&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,w("cleanup"),n.removeListener("close",p),n.removeListener("finish",d),n.removeListener("drain",c),n.removeListener("error",h),n.removeListener("unpipe",i),r.removeListener("end",s),r.removeListener("end",g),r.removeListener("data",l),u=!0,!o.awaitDrain||n._writableState&&!n._writableState.needDrain||c())}function s(){w("onend"),n.end()}o.endEmitted?v.nextTick(t):r.once("end",t),n.on("unpipe",i);var a,c=(a=r,function(){var e=a._readableState;w("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&b(a,"data")&&(e.flowing=!0,F(a))});n.on("drain",c);var u=!1;var f=!1;function l(e){w("ondata"),(f=!1)!==n.write(e)||f||((1===o.pipesCount&&o.pipes===n||1<o.pipesCount&&-1!==x(o.pipes,n))&&!u&&(w("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,f=!0),r.pause())}function h(e){w("onerror",e),g(),n.removeListener("error",h),0===b(n,"error")&&n.emit("error",e)}function p(){n.removeListener("finish",d),g()}function d(){w("onfinish"),n.removeListener("close",p),g()}function g(){w("unpipe"),r.unpipe(n)}return r.on("data",l),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?m(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(n,"error",h),n.once("close",p),n.once("finish",d),n.emit("pipe",r),o.flowing||(w("pipe resume"),r.resume()),n},h.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,o=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<o;i++)r[i].emit("unpipe",this,n);return this}var s=x(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},h.prototype.addListener=h.prototype.on=function(e,t){var n=o.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&C(this):v.nextTick(R,this))}return n},h.prototype.resume=function(){var e,t,n=this._readableState;return n.flowing||(w("resume"),n.flowing=!0,e=this,(t=n).resumeScheduled||(t.resumeScheduled=!0,v.nextTick(S,e,t))),this},h.prototype.pause=function(){return w("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(w("pause"),this._readableState.flowing=!1,this.emit("pause")),this},h.prototype.wrap=function(t){var n=this,r=this._readableState,o=!1;for(var e in t.on("end",function(){if(w("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),t.on("data",function(e){(w("wrapped data"),r.decoder&&(e=r.decoder.write(e)),r.objectMode&&null==e)||(r.objectMode||e&&e.length)&&(n.push(e)||(o=!0,t.pause()))}),t)void 0===this[e]&&"function"==typeof t[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));for(var i=0;i<l.length;i++)t.on(l[i],this.emit.bind(this,l[i]));return this._read=function(e){w("wrapped _read",e),o&&(o=!1,t.resume())},this},Object.defineProperty(h.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),h._fromList=A}).call(this,j(0),j(1))},function(e,t,n){e.exports=n(6).EventEmitter},function(e,t,n){"use strict";var i=n(21);function s(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,r=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return r||o?t?t(e):!e||this._writableState&&this._writableState.errorEmitted||i.nextTick(s,this,e):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(i.nextTick(s,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(k,e,E){"use strict";(function(e,t,n){var v=E(21);function l(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;e.entry=null;for(;r;){var o=r.callback;t.pendingcb--,o(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}k.exports=f;var a,h=!e.browser&&-1<["v0.10","v0.9."].indexOf(e.version.slice(0,5))?t:v.nextTick;f.WritableState=u;var r=E(14);r.inherits=E(10);var o={deprecate:E(108)},i=E(41),m=E(13).Buffer,b=n.Uint8Array||function(){};var s,c=E(42);function w(){}function u(e,t){a=a||E(11),e=e||{};var n=t instanceof a;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,o=e.writableHighWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n&&(o||0===o)?o:i,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var s=(this.destroyed=!1)===e.decodeStrings;this.decodeStrings=!s,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,o=n.writecb;if(l=n,l.writing=!1,l.writecb=null,l.length-=l.writelen,l.writelen=0,t)s=e,a=n,c=r,u=t,f=o,--a.pendingcb,c?(v.nextTick(f,u),v.nextTick(C,s,a),s._writableState.errorEmitted=!0,s.emit("error",u)):(f(u),s._writableState.errorEmitted=!0,s.emit("error",u),C(s,a));else{var i=g(n);i||n.corked||n.bufferProcessing||!n.bufferedRequest||d(e,n),r?h(p,e,n,i,o):p(e,n,i,o)}var s,a,c,u,f;var l}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new l(this)}function f(e){if(a=a||E(11),!(s.call(f,this)||this instanceof a))return new f(e);this._writableState=new u(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),i.call(this)}function _(e,t,n,r,o,i,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(o,t.onwrite):e._write(o,i,t.onwrite),t.sync=!1}function p(e,t,n,r){var o,i;n||(o=e,0===(i=t).length&&i.needDrain&&(i.needDrain=!1,o.emit("drain"))),t.pendingcb--,r(),C(e,t)}function d(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,o=new Array(r),i=t.corkedRequestsFree;i.entry=n;for(var s=0,a=!0;n;)(o[s]=n).isBuf||(a=!1),n=n.next,s+=1;o.allBuffers=a,_(e,t,!0,t.length,o,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new l(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,u=n.encoding,f=n.callback;if(_(e,t,!1,t.objectMode?1:c.length,c,u,f),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function g(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function y(t,n){t._final(function(e){n.pendingcb--,e&&t.emit("error",e),n.prefinished=!0,t.emit("prefinish"),C(t,n)})}function C(e,t){var n,r,o=g(t);return o&&(n=e,(r=t).prefinished||r.finalCalled||("function"==typeof n._final?(r.pendingcb++,r.finalCalled=!0,v.nextTick(y,n,r)):(r.prefinished=!0,n.emit("prefinish"))),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),o}r.inherits(f,i),u.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(u.prototype,"buffer",{get:o.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(s=Function.prototype[Symbol.hasInstance],Object.defineProperty(f,Symbol.hasInstance,{value:function(e){return!!s.call(this,e)||this===f&&(e&&e._writableState instanceof u)}})):s=function(e){return e instanceof this},f.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},f.prototype.write=function(e,t,n){var r,o,i,s,a,c,u,f,l,h,p,d=this._writableState,g=!1,y=!d.objectMode&&(r=e,m.isBuffer(r)||r instanceof b);return y&&!m.isBuffer(e)&&(o=e,e=m.from(o)),"function"==typeof t&&(n=t,t=null),y?t="buffer":t||(t=d.defaultEncoding),"function"!=typeof n&&(n=w),d.ended?(l=this,h=n,p=new Error("write after end"),l.emit("error",p),v.nextTick(h,p)):(y||(i=this,s=d,c=n,f=!(u=!0),null===(a=e)?f=new TypeError("May not write null values to stream"):"string"==typeof a||void 0===a||s.objectMode||(f=new TypeError("Invalid non-string/buffer chunk")),f&&(i.emit("error",f),v.nextTick(c,f),u=!1),u))&&(d.pendingcb++,g=function(e,t,n,r,o,i){if(!n){var s=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=m.from(t,n));return t}(t,r,o);r!==s&&(n=!0,o="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:o,isBuf:n,callback:i,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else _(e,t,!1,a,r,o,i);return c}(this,d,y,e,t,n)),g},f.prototype.cork=function(){this._writableState.corked++},f.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||d(this,e))},f.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),f.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},f.prototype._writev=null,f.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,t=e=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,C(e,t),n&&(t.finished?v.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(f.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),f.prototype.destroy=c.destroy,f.prototype._undestroy=c.undestroy,f.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,E(1),E(106).setImmediate,E(0))},function(e,t,n){"use strict";var r=n(13).Buffer,o=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===o||!o(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=u,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=f,this.end=l,t=3;break;default:return this.write=h,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(1<e.lastNeed&&1<t.length){if(128!=(192&t[1]))return e.lastNeed=1,"";if(2<e.lastNeed&&2<t.length&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1);var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(55296<=r&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function f(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function l(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}(t.StringDecoder=i).prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},i.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},i.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var o=s(t[r]);if(0<=o)return 0<o&&(e.lastNeed=o-1),o;if(--r<n||-2===o)return 0;if(0<=(o=s(t[r])))return 0<o&&(e.lastNeed=o-2),o;if(--r<n||-2===o)return 0;if(0<=(o=s(t[r])))return 0<o&&(2===o?o=0:e.lastNeed=o-3),o;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},i.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";e.exports=i;var r=n(11),o=n(14);function i(e){if(!(this instanceof i))return new i(e);r.call(this,e),this._transformState={afterTransform:function(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,(n.writecb=null)!=t&&this.push(t),r(e);var o=this._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",s)}function s(){var n=this;"function"==typeof this._flush?this._flush(function(e,t){a(n,e,t)}):a(this,null,null)}function a(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}o.inherits=n(10),o.inherits(i,r),i.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},i.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},i.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var o=this._readableState;(r.needTransform||o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}},i.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},i.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,function(e){t(e),n.emit("close")})}},function(e,t,o){(function(i){function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var f=o(6),l=o(15),h=o(4)(),p=o(2)("spa"),d=new(function(){function e(){u(this,e),this._statistics={message:0},this.manager=new Map,this._options={latency:function(e){setTimeout(e,0)}},p("manager initialized")}return t(e,[{key:"set",value:function(e,t){if(this.manager.has(e))throw new Error("this peer already exsists: "+e);this.manager.set(e,t)}},{key:"connect",value:function(e,t){p("peer connected from/to: ",e,t),this.manager.get(t)._connectWith(e),this.manager.get(e)._connectWith(t)}},{key:"destroy",value:function(e,t){p("peer disconnected from/to: ",e,t),this.manager.get(e)&&this.manager.get(e)._close(),this.manager.get(t)&&this.manager.get(t)._close()}},{key:"send",value:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;this._send(e,t,n,r)}},{key:"_send",value:function(e,t,n){3<arguments.length&&void 0!==arguments[3]&&arguments[3];try{if(!this.manager.has(e)||!this.manager.has(t))throw new Error("need a (from) and (to) peer.");this.manager.get(t).emit("data",n),this._statistics.message++}catch(e){throw new Error("cannot send the message. perhaps your destination is not reachable.",e)}}},{key:"stats",get:function(){return this._statistics}}]),e}());e.exports=function(e){function o(e){var t,n,r;return u(this,o),n=this,r=a(o).call(this),(t=!r||"object"!==s(r)&&"function"!=typeof r?c(n):r)._manager=d,t._options=l({id:h.new(),initiator:!1},e),t.id=t._options.id,t._isNegotiating=!1,t.connected=!1,t.disconnected=!1,t.connectedWith=void 0,t.__initiated=!1,t.messageBuffer=[],p("peer initiated:",t.id,t._options.initiator),t._options.initiator&&i.nextTick(function(){t._init()}),t._manager.set(t.id,c(c(t))),t.on("internal_close",function(){t._manager.manager.delete(t.id)}),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}(o,f),t(o,[{key:"send",value:function(e){this.connectedWith?(0<this.messageBuffer.length&&this._reviewMessageBuffer(),this.connectedWith?this._send(this.connectedWith,e):this.messageBuffer.push(e)):this.messageBuffer.push(e)}},{key:"destroy",value:function(){this._manager.destroy(this.id,this.connectedWith)}},{key:"signal",value:function(e){"accept"===e.type?(p("offer-accept received:",e),this._connect(e)):"init"===e.type&&(this._isNegotiating=!0,p("offer-init received:",e),this.emit("signal",this._createAccept(e)))}},{key:"_error",value:function(e){p(e),this.emit("internal_close"),this.emit("error",e)}},{key:"_close",value:function(){this.emit("internal_close"),p("[%s] is closed.",this.id),this.emit("close")}},{key:"_init",value:function(){this._isNegotiating=!0;var e=this._createOffer();e.count=1,this.emit("signal",e)}},{key:"_createOffer",value:function(){return{offerId:h.new(),type:"init",offer:{initiator:this.id}}}},{key:"_createAccept",value:function(e){var t=this._createOffer();return t.type="accept",t.offerId=e.offerId,t.offer.initiator=e.offer.initiator,t.offer.acceptor=this.id,t.count=e.count,t}},{key:"_reviewMessageBuffer",value:function(){for(p("Review the buffer: ",this.messageBuffer.length);this.connectedWith&&0!==this.messageBuffer.length;)this._send(this.messageBuffer.pop())}},{key:"_send",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.connectedWith,t=1<arguments.length?arguments[1]:void 0;if(!e)throw new Error("It must have a destination.");this._manager.send(this.id,e,t)}},{key:"_connect",value:function(e){if(!e.offer.acceptor)throw new Error("It must have an acceptor");this._manager.connect(e.offer.initiator,e.offer.acceptor)}},{key:"_connectWith",value:function(e){this.connected=!0,this._isNegotiating=!1,this.connectedWith=e,this.emit("connect")}}],[{key:"manager",get:function(){return d}}]),o}()}).call(this,o(1))},function(e,t,v){function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function b(a){return function(){var e=this,s=arguments;return new Promise(function(t,n){var r=a.apply(e,s);function o(e){c(r,t,n,o,i,"next",e)}function i(e){c(r,t,n,o,i,"throw",e)}o(void 0)})}}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var E=v(15),O=v(16),R=v(3),S=v(4)(),F=v(6),A=v(7).bridgeIO,T=v(7).bridgeOO,I=v(7).bridgeOI,x=v(7).direct,P=v(7).offline,j=v(7).online,B=v(92),n=function(e){function i(e){var n,t,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),t=this,r=_(i).call(this),n=!r||"object"!==m(r)&&"function"!=typeof r?k(t):r;var o=S.new();return n.options=E({n2n:{protocol:"n2n",id:o,timeout:1e4,SocketClass:v(93).simplepeer},socket:{objectMode:!1},signaling:E({room:"default",id:o},v(110))},e),n._debug=v(2)("n2n:n2n"),n._debugMessage=v(2)("n2n:message"),n.id=n.options.n2n.id,n._pending=new Map,n._all=new Map,n.pendingInview=new Map,n.pendingOutview=new Map,n.livingInview=new Map,n.livingOutview=new B,n.events=new F,n.on("lock",function(e){n._debug("[%s] a connection has been locked: %s",n.id,e)}),n.on("unlock",function(e){n._debug("[%s] a connection has been unlocked: %s",n.id,e)}),n.on(n.options.n2n.protocol,function(e,t){n._debugMessage("[%s/%s] receive a message from %s:",n.id,n.options.n2n.protocol,e,t),n._receive(e,t)}),n.signaling={bridgeIO:new A(n.options.signaling,k(k(n))),bridgeOO:new T(n.options.signaling,k(k(n))),bridgeOI:new I(n.options.signaling,k(k(n))),direct:new x(n.options.signaling,k(k(n))),offline:new P(n.options.signaling,k(k(n))),online:new j(n.options.signaling,k(k(n)))},n}var t,n,r,o,s,a,c,u,f,l,h,p,d,g,y;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(i,F),t=i,(n=[{key:"connect",value:(y=b(regeneratorRuntime.mark(function e(s){var a,c=this,t=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=1<t.length&&void 0!==t[1]?t[1]:this.signaling.online,!s){e.next=13;break}if(this.livingOutview.has(s.id))return e.abrupt("return",this.increaseOccurences(s.id).then(function(){return s.id}));e.next=6;break;case 6:if(this.pendingOutview.has(s.id)){e.next=10;break}return e.abrupt("return",new Promise(function(){var n=b(regeneratorRuntime.mark(function e(t,n){var r,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.signaling.offline,e.next=3,a.connect();case 3:r=S.new(),(o=c.createNewSocket(c.options.socket,s.id,!0)).on("error",function(e){c._manageError(e,s.id,!0,n,"direct connection")}),o.on(R.socket.EMIT_OFFER,function(e){s.signaling.offline.receiveOffer({jobId:r,initiator:c.id,destination:s.id,offer:e,type:"new"})}),i=function(e){e.jobId===r&&c.signaling.offline.receiveOffer(e)},s.signaling.offline.on(R.signaling.EMIT_OFFER,i),o.connect().then(function(){s.signaling.offline.removeListener(R.signaling.EMIT_OFFER,i),t(s.id)}).catch(function(e){n(e)});case 10:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}()));case 10:return e.abrupt("return",Promise.reject(new Error("The connection is already pending. Retry after the first connection was created.")));case 11:e.next=14;break;case 13:return e.abrupt("return",new Promise(function(o,i){a.connect(c.options.signaling.room).then(b(regeneratorRuntime.mark(function e(){var n,r,t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getNewPeer({initiator:c.id,room:c.options.signaling.room});case 2:if(!(n=e.sent)){e.next=19;break}if(!c.livingOutview.has(n)){e.next=8;break}c.increaseOccurences(n).then(function(){o(n)}).catch(function(e){i(e)}),e.next=17;break;case 8:if(c.pendingOutview.has(n)){e.next=16;break}r=S.new(),(t=c.createNewSocket(c.options.socket,n,!0)).on("error",function(e){c._manageError(e,n,!0,i,"signaling connection")}),t.on(R.socket.EMIT_OFFER,function(e){var t={jobId:r,initiator:c.id,destination:n,offer:e,type:"new"};a.sendOffer(t)}),t.connect().then(function(){o(n)}).catch(i),e.next=17;break;case 16:return e.abrupt("return",Promise.reject(new Error("The connection is already pending. Retry after the first connection was created.")));case 17:e.next=20;break;case 19:o(n);case 20:case"end":return e.stop()}},e,this)}))).catch(function(e){i(e)})}));case 14:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"connect4u",value:(g=b(regeneratorRuntime.mark(function e(){var t,n,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=0<r.length&&void 0!==r[0]?r[0]:null,n=1<r.length&&void 0!==r[1]?r[1]:null,t===this.id&&(t=null),n===this.id&&(n=null),t&&"string"==typeof t&&n&&"string"==typeof n)return this._debug("[%s] %s -bridgeIO> %s !",this.id,t,n),e.abrupt("return",this.bridgeOO(t,n));e.next=9;break;case 9:if(t&&"string"==typeof t&&null===n)return this._debug("[%s] %s -> %s !",this.id,t,this.id),e.abrupt("return",this.connectToUs(t));e.next=14;break;case 14:if(!n||"string"!=typeof n||null!==t){e.next=23;break}if(this.livingOutview.has(n))return this._debug("[%s] %s -> %s !",this.id,this.id,n),e.abrupt("return",this.connectFromUs(n));e.next=20;break;case 20:return e.abrupt("return",Promise.reject(new Error(n+" need to be in our outview.")));case 21:e.next=24;break;case 23:return e.abrupt("return",Promise.reject(O.nyi()));case 24:case"end":return e.stop()}},e,this)})),function(){return g.apply(this,arguments)})},{key:"connectFromUs",value:(d=b(regeneratorRuntime.mark(function e(t){var n=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return!(1<n.length&&void 0!==n[1])||n[1],e.abrupt("return",this.increaseOccurences(t,!0));case 2:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"connectToUs",value:(p=b(regeneratorRuntime.mark(function e(t){var n,r,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=1<o.length&&void 0!==o[1]?o[1]:this.options.n2n.timeout,r=!(2<o.length&&void 0!==o[2])||o[2],e.abrupt("return",this.signaling.direct.connectToUs(t,n,r));case 3:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"bridgeIO",value:(h=b(regeneratorRuntime.mark(function e(t,n){var r,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=2<o.length&&void 0!==o[2]?o[2]:this.options.n2n.timeout,e.abrupt("return",this.signaling.bridgeIO.bridge(t,n,r));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"bridgeOI",value:(l=b(regeneratorRuntime.mark(function e(t,n){var r,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=2<o.length&&void 0!==o[2]?o[2]:this.options.n2n.timeout,e.abrupt("return",this.signaling.bridgeOI.bridge(t,n,r));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"bridgeOO",value:(f=b(regeneratorRuntime.mark(function e(t,n){var r,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=2<o.length&&void 0!==o[2]?o[2]:this.options.n2n.timeout,e.abrupt("return",this.signaling.bridgeOO.bridge(t,n,r));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return f.apply(this,arguments)})},{key:"send",value:(u=b(regeneratorRuntime.mark(function e(){var t,n,r,o,i,s=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=0<s.length&&void 0!==s[0]?s[0]:"receive",n=1<s.length?s[1]:void 0,r=2<s.length?s[2]:void 0,o=!(3<s.length&&void 0!==s[3])||s[3],i={protocol:t,msg:r},o)return e.abrupt("return",this._sendOutview(n,i));e.next=9;break;case 9:if(o){e.next=11;break}return e.abrupt("return",this._sendInview(n,i));case 11:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"_sendInview",value:(c=b(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.livingInview.has(t))return this._debugMessage("[%s/n2n] sending a message on the inview to:  %s",this.id,t,n),e.abrupt("return",this.livingInview.get(t).socket.send(this._serialize(n)));e.next=5;break;case 5:throw new Error("["+this.id+"] Peer not found in the inview: "+t);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"_sendOutview",value:(a=b(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.livingOutview.has(t))return this._debugMessage("[%s/n2n] sending a message on the outview to:  %s",this.id,t,n),e.abrupt("return",this.livingOutview.get(t).socket.send(this._serialize(n)));e.next=5;break;case 5:throw new Error("["+this.id+"] Peer not found in the outview: "+t);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"disconnect",value:(s=b(regeneratorRuntime.mark(function e(t){var r,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=17;break}if(this.livingOutview.has(t)){e.next=5;break}throw new Error("peer not found in the outview");case 5:if(0===this.livingOutview.get(t).occurences)throw new Error("Occurences = 0, Maybe the peer is already being disconnected.");e.next=10;break;case 10:if(this.livingOutview.available(t))return e.abrupt("return",this.decreaseOccOutview(t));e.next=14;break;case 14:throw new Error("Peer not available, because connections are locked.");case 15:e.next=24;break;case 17:if(r=[],this.livingOutview.forEach(function(e,t){for(var n=0;n<e.occurences-e.lock;++n)r.push(t)}),0===r.length)throw new Error("No peers to disconnect");e.next=23;break;case 23:return e.abrupt("return",r.reduce(function(e,n){return e.then(function(){return new Promise(function(t,e){o.disconnect(n).then(function(){t()}).catch(function(e){console.error(e),t()})})})},Promise.resolve()));case 24:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"lock",value:function(e){if(this.livingOutview.has(e)){if(this.livingOutview.available(e))return this.livingOutview.get(e).lock++,this.emit("lock-"+e),this.emit("lock",e),!0;throw new Error("[".concat(this.id,"] cannot lock this connection id= ").concat(e,", not available, (lock= ").concat(this.livingOutview.get(e).lock," and occurences= ").concat(this.livingOutview.get(e).occurences,")"))}return O.peerNotFound(e)}},{key:"unlock",value:function(e){if(this.livingOutview.has(e)){var t=this.livingOutview.get(e);if(0<t.lock&&0<t.occurences&&"connected"===t.socket.status)return this.livingOutview.get(e).lock--,this.emit("unlock-"+e),this.emit("unlock",e),!0;throw new Error("[".concat(this.id,"] cannot unlock a connection under the status ").concat(t.socket.status,", (lock= ").concat(t.lock," and occurences= ").concat(t.occurences,"), not locked!"))}throw new Error("[".concat(this.id,"] cannot unlock a connection that does not exist. id=").concat(e))}},{key:"increaseOccurences",value:function(n){var r=this;return new Promise(function(t,e){r.livingOutview.has(n)?(r.livingOutview.get(n).occurences++,r.send(r.options.n2n.protocol,n,{type:R.n2n.INC_IN}).then(function(){r._signalConnect(n,!0),t()}).catch(function(e){console.warn("[%s] cannot send INC_IN message to %s",r.id,n),r._signalConnect(n,!0),t()})):e(O.peerNotFound(n))})}},{key:"decreaseOccOutview",value:(o=b(regeneratorRuntime.mark(function e(t){var n,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.livingOutview.has(t)){e.next=4;break}throw O.peerNotFound(t);case 4:if(0<(n=this.livingOutview.get(t)).lock&&0===n.occurences)throw new Error("lock cannot be higher than the number of occurences when a deletion is performed.");e.next=9;break;case 9:if(0<n.occurences&&n.occurences>n.lock)return this.livingOutview.get(t).occurences--,e.abrupt("return",this.send(this.options.n2n.protocol,t,{type:R.n2n.DEC_IN}).then(function(){return 0===r.livingOutview.get(t).occurences?(r._signalDisconnect(t,!0,!1),r.send(r.options.n2n.protocol,t,{type:R.n2n.DISCONNECT}).then(function(){return n.socket.disconnect(r.options.socket)}).catch(function(e){return n.socket.disconnect()})):(r._signalDisconnect(t,!0,!1),Promise.resolve())}).catch(function(e){return console.warn("[%s] cannot send the message to %s",r.id,t),0===r.livingOutview.get(t).occurences?(r._signalDisconnect(t,!0,!1),r.send(r.options.n2n.protocol,t,{type:R.n2n.DISCONNECT}).then(function(){return n.socket.disconnect()}).catch(function(e){return n.socket.disconnect()})):(r._signalDisconnect(t,!0,!1),Promise.resolve())}));e.next=14;break;case 14:throw new Error("PLEASE REPORT: decreaseOccOutview");case 15:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"_decreaseInview",value:function(e){this.livingInview.has(e)&&(this.livingInview.get(e).occurences--,this._signalDisconnect(e,!1,!1))}},{key:"_increaseInview",value:function(e){this.livingInview.has(e)&&(this.livingInview.get(e).occurences++,this._signalConnect(e,!1))}},{key:"_disconnectInview",value:function(e){this.livingInview.has(e)&&this.livingInview.get(e).socket.disconnect()}},{key:"crash",value:function(){this.livingOutview.forEach(function(e){e.socket.disconnect()}),this.livingInview.forEach(function(e){e.socket.disconnect()})}},{key:"createNewSocket",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this.options.n2n.timeout,i=new this.options.n2n.SocketClass(e),s=i.socketId;this._debug("[%s] new socket created: %s with timeout",this.id,i.socketId,o);var a=setTimeout(function(){r?n.pendingOutview.get(t).socket.socketId===s?n._deletePending(t,r):console.error(new Error("SID not equaled. Please report this error.")):n.pendingInview.get(t).socket.socketId===s?n._deletePending(t,r):console.error(new Error("SID not equaled. Please report this error."))},o);return i.status="connecting",i.once("connect",function(){n._pending.delete(s),clearTimeout(a),r?(n._deletePending(t,r),n.livingOutview.set(t,{socket:i,occurences:1,lock:0}),n._signalConnect(t,!0)):(n._deletePending(t,r),n.livingInview.set(t,{socket:i,occurences:1,lock:0}),n._signalConnect(t,!1))}),i.on("data",function(e){n.__receive(t,e)}),i.once("close",function(e){n._manageClose(t,r,e)}),r||i.once("error",function(e){n._manageError(e,t,r,void 0,"inview error")}),r?this.pendingOutview.set(t,{socket:i,occurences:0,lock:0}):this.pendingInview.set(t,{socket:i,occurences:0,lock:0}),i}},{key:"_manageError",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=3<arguments.length?arguments[3]:void 0,o=4<arguments.length?arguments[4]:void 0;console.trace(this.id,e,t,n,r,n&&this.livingOutview.get(t).socket,o),"Ice connection failed."===e.message?this._debug("Chrome disconnection: ",t,e):this._debug("[%s] Error of the socket: (%s), this is just a log. The error is catched. [reject:".concat(m(r),"]"),this.id,t,e),r&&(console.trace(e),r(e))}},{key:"_manageClose",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length?arguments[2]:void 0;if(t&&this.livingOutview.has(e)){var r=this.livingOutview.get(e);if(r.socket.socketId===n&&(this._debug("[%s] close outview: ",this.id,e,t,r),this._deleteLiving(e,t),0<r.occurences)){this._signalCrash(e,r.occurences,t);for(var o=0;o<r.occurences;++o)this._signalDisconnect(e,t,!0)}}else if(!t&&this.livingInview.has(e)){var i=this.livingInview.get(e);if(i.socket.socketId===n){if(this._deleteLiving(e,t),0<i.occurences){this._signalCrash(e,i.occurences,t);for(var s=0;s<i.occurences;++s)this._signalDisconnect(e,t,!0)}this._debug("[%s] close inview: ",this.id,e,t)}}else console.warn("[socket does not exist] Connection closed",e)}},{key:"_deleteLiving",value:function(e,t){t?(this._debug("[%s] deleting outview living entry:",this.id,e),this.livingOutview.delete(e)):(this._debug("[%s] deleting inview living entry:",this.id,e),this.livingInview.delete(e))}},{key:"_deletePending",value:function(e,t){t?(this._debug("[%s] deleting outview pending entry:",this.id,e),this.pendingOutview.delete(e)):(this._debug("[%s] deleting inview pending entry:",this.id,e),this.pendingInview.delete(e))}},{key:"_serialize",value:function(e){return JSON.stringify(e)}},{key:"_deserialize",value:function(e){return JSON.parse(e)}},{key:"_signalConnect",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];setTimeout(function(){n?t.emit(R.n2n.connection.out,e,!0):t.emit(R.n2n.connection.in,e,!1)},0)}},{key:"_signalDisconnect",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];setTimeout(function(){t?n.emit(R.n2n.disconnection.out,e,r):n.emit(R.n2n.disconnection.in,e,r)},0)}},{key:"_signalCrash",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];setTimeout(function(){r?n.emit(R.n2n.crash.out,e,t,r):n.emit(R.n2n.crash.in,e,t,r)},0)}},{key:"__receive",value:function(t,n){try{n=this._deserialize(n),this.emit(n.protocol,t,n.msg)}catch(e){console.error(new Error("Impossible to parse data: "+e.message),t,n)}}},{key:"getNeighbours",value:function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0]?this.getAllNeighbours():this.getNeighboursOutview()}},{key:"getAllNeighbours",value:function(){var n=[];return this.livingOutview.forEach(function(e,t){0<e.occurences&&"connected"===e.socket.status&&n.push({peer:e,id:t})}),n}},{key:"getNeighboursIds",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return this.getNeighbours(e).map(function(e){return e.id})}},{key:"getNeighboursOutview",value:function(){var n=[];return this.livingOutview.forEach(function(e,t){n.push({peer:e,id:t})}),n}},{key:"getNeighboursInview",value:function(){var n=[];return this.livingInview.forEach(function(e,t){n.push({peer:e,id:t})}),n}},{key:"getArcs",value:function(){var r=this,o=[];return this.livingInview.forEach(function(e,t){for(var n=0;n<e.occurences;++n)o.push({source:r.id,target:t,outview:!1})}),this.livingOutview.forEach(function(e,t){for(var n=0;n<e.occurences;++n)o.push({source:r.id,target:t,outview:!0})}),o}},{key:"_receive",value:function(e,t){switch(t.type){case R.n2n.DISCONNECT:this._disconnectInview(e);break;case R.n2n.DEC_IN:this._decreaseInview(e);break;case R.n2n.INC_IN:this._increaseInview(e);break;case R.n2n.CONNECT_TO_US:this.signaling.direct._connectToUs(t);break;case R.n2n.RESPONSE:this.events.emit(t.jobId,t);break;case R.n2n.DIRECT_TO:case R.n2n.DIRECT_BACK:this.signaling.direct.receiveOffer(t);break;case R.n2n.bridgeIO.BRIDGE:this.signaling.bridgeIO._bridge(e,t);break;case R.n2n.bridgeIO.BRIDGE_FORWARD:this.signaling.bridgeIO.forward(t);break;case R.n2n.bridgeIO.BRIDGE_FORWARD_BACK:this.signaling.bridgeIO.forwardBack(t);break;case R.n2n.bridgeIO.BRIDGE_FORWARD_RESPONSE:this.signaling.bridgeIO.receiveOffer(t);break;case R.n2n.bridgeOI.BRIDGE:this.signaling.bridgeOI._bridge(e,t);break;case R.n2n.bridgeOI.BRIDGE_FORWARD:this.signaling.bridgeOI.forward(t);break;case R.n2n.bridgeOI.BRIDGE_FORWARD_BACK:this.signaling.bridgeOI.forwardBack(t);break;case R.n2n.bridgeOI.BRIDGE_FORWARD_RESPONSE:this.signaling.bridgeOI.receiveOffer(t);break;case R.n2n.bridgeOO.BRIDGE:this.signaling.bridgeOO._bridge(e,t);break;case R.n2n.bridgeOO.BRIDGE_FORWARD:this.signaling.bridgeOO.forward(t);break;case R.n2n.bridgeOO.BRIDGE_FORWARD_BACK:this.signaling.bridgeOO.forwardBack(t);break;case R.n2n.bridgeOO.BRIDGE_FORWARD_RESPONSE:this.signaling.bridgeOO.receiveOffer(t);break;default:throw new Error("case not handled.")}}}])&&w(t.prototype,n),r&&w(t,r),i}();e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports=function(){return new Error("not yet implemented.")}},function(e,t){e.exports=function(e){return new Error("Peer Not found: "+e)}},function(e,t){e.exports=function(){return new Error("This message is not handled by the system.")}},function(e,t,n){var r=n(53);function o(e,t){var n=new r(e,t);return function(e){return n.convert(e)}}o.BIN="01",o.OCT="01234567",o.DEC="0123456789",o.HEX="0123456789abcdef",e.exports=o},function(e,t,n){"use strict";function r(e,t){if(!(e&&t&&e.length&&t.length))throw new Error("Bad alphabet");this.srcAlphabet=e,this.dstAlphabet=t}r.prototype.convert=function(e){var t,n,r,o={},i=this.srcAlphabet.length,s=this.dstAlphabet.length,a=e.length,c="string"==typeof e?"":[];if(!this.isValid(e))throw new Error('Number "'+e+'" contains of non-alphabetic digits ('+this.srcAlphabet+")");if(this.srcAlphabet===this.dstAlphabet)return e;for(t=0;t<a;t++)o[t]=this.srcAlphabet.indexOf(e[t]);do{for(t=r=n=0;t<a;t++)s<=(n=n*i+o[t])?(o[r++]=parseInt(n/s,10),n%=s):0<r&&(o[r++]=0);a=r,c=this.dstAlphabet.slice(n,n+1).concat(c)}while(0!==r);return c},r.prototype.isValid=function(e){for(var t=0;t<e.length;++t)if(-1===this.srcAlphabet.indexOf(e[t]))return!1;return!0},e.exports=r},function(e,t,n){var s=n(55),a=n(56);e.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||s)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var i=0;i<16;++i)t[r+i]=o[i];return t||a(o)}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},function(e,t){for(var o=[],n=0;n<256;++n)o[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,r=o;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")}},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=n(5),p=n(3),d=n(58),g=n(4)(),o=function(e){function n(e,t){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(s=u(this,f(n).call(this,e))).parent=t,s.on(p.signaling.RECEIVE_OFFER,function(e){var n=e.jobId,r=e.initiator,o=e.destination,t=e.type,i=e.offer;if(!(r&&o&&i&&t))throw new Error("PLEASE REPORT, Problem with the offline signaling service. provide at least initiator, destination, type a,d the offer as properties in the object received");s.parent.livingInview.has(r)||"new"!==t?"new"===t?s.parent.pendingInview.has(r)?s.parent.pendingInview.get(r).socket.emit(p.socket.RECEIVE_OFFER,i):s.parent.livingInview.has(r)&&s.parent.livingInview.get(r).socket.emit(p.socket.RECEIVE_OFFER,i):"back"===t&&(s.parent.pendingOutview.has(o)?s.parent.pendingOutview.get(o).socket.emit(p.socket.RECEIVE_OFFER,i):s.parent.livingOutview.has(o)&&s.parent.livingOutview.get(o).socket.emit(p.socket.RECEIVE_OFFER,i)):(s.parent.createNewSocket(s.parent.options.socket,r,!1),s.parent.pendingInview.get(r).socket.on(p.socket.EMIT_OFFER,function(e){s.sendOffer({initiator:r,destination:o,offer:e,type:"back"})}),s.parent.pendingInview.get(r).socket.on(p.socket.EMIT_OFFER_RENEGOCIATE,function(e){console.log("[bridge] receive a negociate offer");var t={jobId:n,initiator:r,destination:o,offer:e,offerType:"back"};s.parent.signaling.direct.sendOfferBackRenegociate(t)}),s.parent.pendingInview.get(r).socket.emit(p.socket.RECEIVE_OFFER,i))}),s}var t,r,o,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(n,h),t=n,(r=[{key:"connect",value:function(){var o=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"default",s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.options;return this.socket?Promise.resolve():new Promise(function(e,t){var n="".concat(s.host,":").concat(s.port),r=d(n,{autoConnect:!1,query:{room:i,id:s.id}});r.connect(),r.once("connect",function(){o._initializeSocket(r),e()}),r.once("connect_error",function(e){r.close(),console.error("Signaling server connect_error: ",e),r.off("connect"),r.off("connect_failed"),r.off("connect_timeout"),t(e)}),r.once("connect_failed",function(e){r.close(),console.error("Signaling server connect_failed: ",e),r.off("connect"),r.off("connect_failed"),r.off("connect_timeout"),t(e)}),r.once("connect_timeout",function(e){r.close(),console.error("Signaling server connect_timeout: ",e),r.off("connect"),r.off("connect_failed"),r.off("connect_error"),t(e)})})}},{key:"_initializeSocket",value:function(t){var n=this;this.socket=t,this.on(p.signaling.EMIT_OFFER,function(e){t.emit("offer",e)}),t.on("offer",function(e){n.emit(p.signaling.RECEIVE_OFFER,e)}),t.on("error",function(e){console.error("SS error: ",e)}),t.on("disconnect",function(e){console.log("SS disconnection: ",e)}),t.on("reconnect_error",function(e){t.close(),console.error("SS disconnection: ",e)}),t.on("reconnect_failed",function(e){t.close(),console.error("SS disconenction: ",e)}),t.on("reconnect_attempt",function(){console.log("SS attempting a reconnection")}),t.on("reconnect",function(e){console.log("SS successfull reconnection when attempting a reconnection: ",e)})}},{key:"getNewPeer",value:function(){var r=this;return new Promise(function(t,e){var n=g.new();r.socket.emit("getNewPeer",n),r.socket.once(n,function(e){t(e)})})}},{key:"sendOffer",value:(a=regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.socket.emit("offer",t);case 1:case"end":return e.stop()}},e,this)}),i=function(){var e=this,s=arguments;return new Promise(function(t,n){var r=a.apply(e,s);function o(e){c(r,t,n,o,i,"next",e)}function i(e){c(r,t,n,o,i,"throw",e)}o(void 0)})},function(e){return i.apply(this,arguments)})}])&&s(t.prototype,r),o&&s(t,o),n}();e.exports=o},function(e,t,n){function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var u=n(59),r=n(22),f=n(28),l=n(17)("socket.io-client");e.exports=t=o;var h=t.managers={};function o(e,t){"object"===c(e)&&(t=e,e=void 0),t=t||{};var n,r=u(e),o=r.source,i=r.id,s=r.path,a=h[i]&&s in h[i].nsps;return n=t.forceNew||t["force new connection"]||!1===t.multiplex||a?(l("ignoring socket cache for %s",o),f(o,t)):(h[i]||(l("new io instance for %s",o),h[i]=f(o,t)),h[i]),r.query&&!t.query&&(t.query=r.query),n.socket(r.path,t)}t.protocol=r.protocol,t.connect=o,t.Manager=n(28),t.Socket=n(35)},function(e,t,n){(function(o){var i=n(25),s=n(17)("socket.io-client:url");e.exports=function(e,t){var n=e;t=t||o.location,null==e&&(e=t.protocol+"//"+t.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(s("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),s("parse %s",e),n=i(e));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));n.path=n.path||"/";var r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port,n.href=n.protocol+"://"+r+(t&&t.port===n.port?"":":"+n.port),n}}).call(this,n(0))},function(e,c,t){function n(e){var r;function a(){if(a.enabled){var o=a,e=+new Date,t=e-(r||e);o.diff=t,o.prev=r,o.curr=e,r=e;for(var i=new Array(arguments.length),n=0;n<i.length;n++)i[n]=arguments[n];i[0]=c.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var s=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(e,t){if("%%"===e)return e;s++;var n=c.formatters[t];if("function"==typeof n){var r=i[s];e=n.call(o,r),i.splice(s,1),s--}return e}),c.formatArgs.call(o,i),(a.log||c.log||console.log.bind(console)).apply(o,i)}}return a.namespace=e,a.enabled=c.enabled(e),a.useColors=c.useColors(),a.color=function(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return c.colors[Math.abs(n)%c.colors.length]}(e),a.destroy=o,"function"==typeof c.init&&c.init(a),c.instances.push(a),a}function o(){var e=c.instances.indexOf(this);return-1!==e&&(c.instances.splice(e,1),!0)}(c=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},c.disable=function(){c.enable("")},c.enable=function(e){var t;c.save(e),c.names=[],c.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(t=0;t<r;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?c.skips.push(new RegExp("^"+e.substr(1)+"$")):c.names.push(new RegExp("^"+e+"$")));for(t=0;t<c.instances.length;t++){var o=c.instances[t];o.enabled=c.enabled(o.namespace)}},c.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=c.skips.length;t<n;t++)if(c.skips[t].test(e))return!1;for(t=0,n=c.names.length;t<n;t++)if(c.names[t].test(e))return!0;return!1},c.humanize=t(61),c.instances=[],c.names=[],c.skips=[],c.formatters={}},function(e,t){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=36e5,s=864e5;function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var n,r=o(e);if("string"===r&&0<e.length)return function(e){if(100<(e=String(e)).length)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"days":case"day":case"d":return n*s;case"hours":case"hour":case"hrs":case"hr":case"h":return n*i;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*n;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===r&&!1===isNaN(e))return t.long?a(n=e,s,"day")||a(n,i,"hour")||a(n,6e4,"minute")||a(n,1e3,"second")||n+" ms":function(e){if(s<=e)return Math.round(e/s)+"d";if(i<=e)return Math.round(e/i)+"h";if(6e4<=e)return Math.round(e/6e4)+"m";if(1e3<=e)return Math.round(e/1e3)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(r,i,o){(function(t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function e(){var e;try{e=i.storage.debug}catch(e){}return!e&&void 0!==t&&"env"in t&&(e=t.env.DEBUG),e}(i=r.exports=o(63)).log=function(){return"object"===("undefined"==typeof console?"undefined":n(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},i.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+i.humanize(this.diff),!t)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var r=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(r++,"%c"===e&&(o=r))}),e.splice(o,0,n)},i.save=function(e){try{null==e?i.storage.removeItem("debug"):i.storage.debug=e}catch(e){}},i.load=e,i.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},i.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),i.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],i.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},i.enable(e())}).call(this,o(1))},function(e,c,t){function n(e){var r;function a(){if(a.enabled){var o=a,e=+new Date,t=e-(r||e);o.diff=t,o.prev=r,o.curr=e,r=e;for(var i=new Array(arguments.length),n=0;n<i.length;n++)i[n]=arguments[n];i[0]=c.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var s=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(e,t){if("%%"===e)return e;s++;var n=c.formatters[t];if("function"==typeof n){var r=i[s];e=n.call(o,r),i.splice(s,1),s--}return e}),c.formatArgs.call(o,i),(a.log||c.log||console.log.bind(console)).apply(o,i)}}return a.namespace=e,a.enabled=c.enabled(e),a.useColors=c.useColors(),a.color=function(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return c.colors[Math.abs(n)%c.colors.length]}(e),a.destroy=o,"function"==typeof c.init&&c.init(a),c.instances.push(a),a}function o(){var e=c.instances.indexOf(this);return-1!==e&&(c.instances.splice(e,1),!0)}(c=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},c.disable=function(){c.enable("")},c.enable=function(e){var t;c.save(e),c.names=[],c.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(t=0;t<r;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?c.skips.push(new RegExp("^"+e.substr(1)+"$")):c.names.push(new RegExp("^"+e+"$")));for(t=0;t<c.instances.length;t++){var o=c.instances[t];o.enabled=c.enabled(o.namespace)}},c.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=c.skips.length;t<n;t++)if(c.skips[t].test(e))return!1;for(t=0,n=c.names.length;t<n;t++)if(c.names[t].test(e))return!0;return!1},c.humanize=t(64),c.instances=[],c.names=[],c.skips=[],c.formatters={}},function(e,t){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=36e5,s=864e5;function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var n,r=o(e);if("string"===r&&0<e.length)return function(e){if(100<(e=String(e)).length)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"days":case"day":case"d":return n*s;case"hours":case"hour":case"hrs":case"hr":case"h":return n*i;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*n;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===r&&!1===isNaN(e))return t.long?a(n=e,s,"day")||a(n,i,"hour")||a(n,6e4,"minute")||a(n,1e3,"second")||n+" ms":function(e){if(s<=e)return Math.round(e/s)+"d";if(i<=e)return Math.round(e/i)+"h";if(6e4<=e)return Math.round(e/6e4)+"m";if(1e3<=e)return Math.round(e/1e3)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,n,r){(function(e){function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var l=r(26),h=r(27),t=Object.prototype.toString,p="function"==typeof e.Blob||"[object BlobConstructor]"===t.call(e.Blob),d="function"==typeof e.File||"[object FileConstructor]"===t.call(e.File);n.deconstructPacket=function(e){var t=[],n=e.data,r=e;return r.data=function e(t,n){if(!t)return t;{if(h(t)){var r={_placeholder:!0,num:n.length};return n.push(t),r}if(l(t)){for(var o=new Array(t.length),i=0;i<t.length;i++)o[i]=e(t[i],n);return o}if("object"===f(t)&&!(t instanceof Date)){var o={};for(var s in t)o[s]=e(t[s],n);return o}}return t}(n,t),r.attachments=t.length,{packet:r,buffers:t}},n.reconstructPacket=function(e,t){return e.data=function e(t,n){if(!t)return t;{if(t&&t._placeholder)return n[t.num];if(l(t))for(var r=0;r<t.length;r++)t[r]=e(t[r],n);else if("object"===f(t))for(var o in t)t[o]=e(t[o],n)}return t}(e.data,t),e.attachments=void 0,e},n.removeBlobs=function(e,a){var c=0,u=e;!function e(t,n,r){if(!t)return t;if(p&&t instanceof Blob||d&&t instanceof File){c++;var o=new FileReader;o.onload=function(){r?r[n]=this.result:u=this.result,--c||a(u)},o.readAsArrayBuffer(t)}else if(l(t))for(var i=0;i<t.length;i++)e(t[i],i,t);else if("object"===f(t)&&!h(t))for(var s in t)e(t[s],s,t)}(u),c||a(u)}}).call(this,r(0))},function(e,t,n){e.exports=n(67),e.exports.parser=n(9)},function(t,e,n){(function(r){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(29),e=n(8),l=n(20)("engine.io-client:socket"),s=n(34),a=n(9),c=n(25),u=n(18);function h(e,t){if(!(this instanceof h))return new h(e,t);t=t||{},e&&"object"===o(e)&&(t=e,e=null),e?(e=c(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=c(t.host).host),this.secure=null!=t.secure?t.secure:r.location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(r.location?location.hostname:"localhost"),this.port=t.port||(r.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=u.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode;var n="object"===(void 0===r?"undefined":o(r))&&r;n.global===n&&(t.extraHeaders&&0<Object.keys(t.extraHeaders).length&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}(t.exports=h).priorWebsocketSuccess=!1,e(h.prototype),h.protocol=a.protocol,(h.Socket=h).Transport=n(24),h.transports=n(29),h.parser=n(9),h.prototype.createTransport=function(e){l('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=a.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new i[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0})},h.prototype.open=function(){var e;if(this.rememberUpgrade&&h.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},h.prototype.setTransport=function(e){l("setting transport %s",e.name);var t=this;this.transport&&(l("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),(this.transport=e).on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},h.prototype.probe=function(n){l('probing transport "%s"',n);var r=this.createTransport(n,{probe:1}),o=!1,i=this;function e(){if(i.onlyBinaryUpgrades){var e=!this.supportsBinary&&i.transport.supportsBinary;o=o||e}o||(l('probe transport "%s" opened',n),r.send([{type:"ping",data:"probe"}]),r.once("packet",function(e){if(!o)if("pong"===e.type&&"probe"===e.data){if(l('probe transport "%s" pong',n),i.upgrading=!0,i.emit("upgrading",r),!r)return;h.priorWebsocketSuccess="websocket"===r.name,l('pausing current transport "%s"',i.transport.name),i.transport.pause(function(){o||"closed"!==i.readyState&&(l("changing transport and sending upgrade packet"),f(),i.setTransport(r),r.send([{type:"upgrade"}]),i.emit("upgrade",r),r=null,i.upgrading=!1,i.flush())})}else{l('probe transport "%s" failed',n);var t=new Error("probe error");t.transport=r.name,i.emit("upgradeError",t)}}))}function s(){o||(o=!0,f(),r.close(),r=null)}function t(e){var t=new Error("probe error: "+e);t.transport=r.name,s(),l('probe transport "%s" failed because of error: %s',n,e),i.emit("upgradeError",t)}function a(){t("transport closed")}function c(){t("socket closed")}function u(e){r&&e.name!==r.name&&(l('"%s" works - aborting "%s"',e.name,r.name),s())}function f(){r.removeListener("open",e),r.removeListener("error",t),r.removeListener("close",a),i.removeListener("close",c),i.removeListener("upgrading",u)}h.priorWebsocketSuccess=!1,r.once("open",e),r.once("error",t),r.once("close",a),this.once("close",c),this.once("upgrading",u),r.open()},h.prototype.onOpen=function(){if(l("socket open"),this.readyState="open",h.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){l("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},h.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(l('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else l('packet received with socket readyState "%s"',this.readyState)},h.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},h.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},h.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){l("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},h.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},h.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),(this.prevBufferLen=0)===this.writeBuffer.length?this.emit("drain"):this.flush()},h.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(l("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},h.prototype.write=h.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},h.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var o={type:e,data:t,options:n};this.emit("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}},h.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():t()}):this.upgrading?r():t()}function t(){e.onClose("forced close"),l("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}return this},h.prototype.onError=function(e){l("socket error %j",e),h.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},h.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){l('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},h.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~s(this.transports,e[n])&&t.push(e[n]);return t}}).call(this,n(0))},function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},function(f,e,l){(function(o){var i=l(23),r=l(30),e=l(8),t=l(19),s=l(20)("engine.io-client:polling-xhr");function n(){}function a(e){if(r.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,o.location){var t="https:"===location.protocol,n=location.port;n||(n=t?443:80),this.xd=e.hostname!==o.location.hostname||n!==e.port,this.xs=e.secure!==t}}function c(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function u(){for(var e in c.requests)c.requests.hasOwnProperty(e)&&c.requests[e].abort()}f.exports=a,f.exports.Request=c,t(a,r),a.prototype.supportsBinary=!0,a.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new c(e)},a.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),o=this;r.on("success",t),r.on("error",function(e){o.onError("xhr post error",e)}),this.sendXhr=r},a.prototype.doPoll=function(){s("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},e(c.prototype),c.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new i(e),n=this;try{s("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.extraHeaders[r])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");n.supportsBinary&&"application/octet-stream"===e&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout(function(){n.onError(t.status)},0))},s("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){n.onError(e)},0)}o.document&&(this.index=c.requestsCount++,c.requests[this.index]=this)},c.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},c.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},c.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},c.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=n:this.xhr.onreadystatechange=n,e)try{this.xhr.abort()}catch(e){}o.document&&delete c.requests[this.index],this.xhr=null}},c.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},c.prototype.hasXDR=function(){return void 0!==o.XDomainRequest&&!this.xs&&this.enablesXDR},c.prototype.abort=function(){this.cleanup()},c.requestsCount=0,c.requests={},o.document&&(o.attachEvent?o.attachEvent("onunload",u):o.addEventListener&&o.addEventListener("beforeunload",u,!1))}).call(this,l(0))},function(e,t){e.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t}},function(e,t,n){"use strict";t.byteLength=function(e){var t=p(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){for(var t,n=p(e),r=n[0],o=n[1],i=new h((u=r,f=o,3*(u+f)/4-f)),s=0,a=0<o?r-4:r,c=0;c<a;c+=4)t=l[e.charCodeAt(c)]<<18|l[e.charCodeAt(c+1)]<<12|l[e.charCodeAt(c+2)]<<6|l[e.charCodeAt(c+3)],i[s++]=t>>16&255,i[s++]=t>>8&255,i[s++]=255&t;var u,f;2===o&&(t=l[e.charCodeAt(c)]<<2|l[e.charCodeAt(c+1)]>>4,i[s++]=255&t);1===o&&(t=l[e.charCodeAt(c)]<<10|l[e.charCodeAt(c+1)]<<4|l[e.charCodeAt(c+2)]>>2,i[s++]=t>>8&255,i[s++]=255&t);return i},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,o=[],i=0,s=n-r;i<s;i+=16383)o.push(c(e,i,s<i+16383?s:i+16383));1===r?(t=e[n-1],o.push(a[t>>2]+a[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],o.push(a[t>>10]+a[t>>4&63]+a[t<<2&63]+"="));return o.join("")};for(var a=[],l=[],h="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,i=r.length;o<i;++o)a[o]=r[o],l[r.charCodeAt(o)]=o;function p(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,n){for(var r,o,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),i.push(a[(o=r)>>18&63]+a[o>>12&63]+a[o>>6&63]+a[63&o]);return i.join("")}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,o){var i,s,a=8*o-r-1,c=(1<<a)-1,u=c>>1,f=-7,l=n?o-1:0,h=n?-1:1,p=e[t+l];for(l+=h,i=p&(1<<-f)-1,p>>=-f,f+=a;0<f;i=256*i+e[t+l],l+=h,f-=8);for(s=i&(1<<-f)-1,i>>=-f,f+=r;0<f;s=256*s+e[t+l],l+=h,f-=8);if(0===i)i=1-u;else{if(i===c)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),i-=u}return(p?-1:1)*s*Math.pow(2,i-r)},t.write=function(e,t,n,r,o,i){var s,a,c,u=8*i-o-1,f=(1<<u)-1,l=f>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:i-1,d=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=f):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),2<=(t+=1<=s+l?h/c:h*Math.pow(2,1-l))*c&&(s++,c/=2),f<=s+l?(a=0,s=f):1<=s+l?(a=(t*c-1)*Math.pow(2,o),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,o),s=0));8<=o;e[n+p]=255&a,p+=d,a/=256,o-=8);for(s=s<<o|a,u+=o;0<u;e[n+p]=255&s,p+=d,s/=256,u-=8);e[n+p-d]|=128*g}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){e.exports=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),r<n&&(n=r),r<=t||n<=t||0===r)return new ArrayBuffer(0);for(var o=new Uint8Array(e),i=new Uint8Array(n-t),s=t,a=0;s<n;s++,a++)i[a]=o[s];return i.buffer}},function(e,t){function s(){}e.exports=function(e,n,r){var o=!1;return r=r||s,0===(i.count=e)?n():i;function i(e,t){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(o=!0,n(e),n=r):0!==i.count||o||n(null,t)}}},function(e,t){var i,s,a,c=String.fromCharCode;function u(e){for(var t,n,r=[],o=0,i=e.length;o<i;)55296<=(t=e.charCodeAt(o++))&&t<=56319&&o<i?56320==(64512&(n=e.charCodeAt(o++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--):r.push(t);return r}function r(e,t){if(55296<=e&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function o(e,t){return c(e>>t&63|128)}function f(e,t){if(0==(4294967168&e))return c(e);var n="";return 0==(4294965248&e)?n=c(e>>6&31|192):0==(4294901760&e)?(r(e,t)||(e=65533),n=c(e>>12&15|224),n+=o(e,6)):0==(4292870144&e)&&(n=c(e>>18&7|240),n+=o(e,12),n+=o(e,6)),n+=c(63&e|128)}function l(){if(s<=a)throw Error("Invalid byte index");var e=255&i[a];if(a++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function h(e){var t,n;if(s<a)throw Error("Invalid byte index");if(a==s)return!1;if(t=255&i[a],a++,0==(128&t))return t;if(192==(224&t)){if(128<=(n=(31&t)<<6|l()))return n;throw Error("Invalid continuation byte")}if(224==(240&t)){if(2048<=(n=(15&t)<<12|l()<<6|l()))return r(n,e)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&65536<=(n=(7&t)<<18|l()<<12|l()<<6|l())&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}e.exports={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,r=u(e),o=r.length,i=-1,s="";++i<o;)s+=f(r[i],n);return s},decode:function(e,t){var n=!1!==(t=t||{}).strict;i=u(e),s=i.length,a=0;for(var r,o=[];!1!==(r=h(n));)o.push(r);return function(e){for(var t,n=e.length,r=-1,o="";++r<n;)65535<(t=e[r])&&(o+=c((t-=65536)>>>10&1023|55296),t=56320|1023&t),o+=c(t);return o}(o)}}},function(e,t){!function(){"use strict";for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=new Uint8Array(256),e=0;e<i.length;e++)l[i.charCodeAt(e)]=e;t.encode=function(e){var t,n=new Uint8Array(e),r=n.length,o="";for(t=0;t<r;t+=3)o+=i[n[t]>>2],o+=i[(3&n[t])<<4|n[t+1]>>4],o+=i[(15&n[t+1])<<2|n[t+2]>>6],o+=i[63&n[t+2]];return r%3==2?o=o.substring(0,o.length-1)+"=":r%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,n,r,o,i,s=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var u=new ArrayBuffer(s),f=new Uint8Array(u);for(t=0;t<a;t+=4)n=l[e.charCodeAt(t)],r=l[e.charCodeAt(t+1)],o=l[e.charCodeAt(t+2)],i=l[e.charCodeAt(t+3)],f[c++]=n<<2|r>>4,f[c++]=(15&r)<<4|o>>2,f[c++]=(3&o)<<6|63&i;return u}}()},function(e,t){var r=void 0!==r?r:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,n=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),o=n&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),i=r&&r.prototype.append&&r.prototype.getBlob;function s(e){return e.map(function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer}return t}return e})}function a(e,t){t=t||{};var n=new r;return s(e).forEach(function(e){n.append(e)}),t.type?n.getBlob(t.type):n.getBlob()}function c(e,t){return new Blob(s(e),t||{})}"undefined"!=typeof Blob&&(a.prototype=Blob.prototype,c.prototype=Blob.prototype),e.exports=n?o?Blob:c:i?a:void 0},function(e,c,t){function n(e){var r;function a(){if(a.enabled){var o=a,e=+new Date,t=e-(r||e);o.diff=t,o.prev=r,o.curr=e,r=e;for(var i=new Array(arguments.length),n=0;n<i.length;n++)i[n]=arguments[n];i[0]=c.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var s=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(e,t){if("%%"===e)return e;s++;var n=c.formatters[t];if("function"==typeof n){var r=i[s];e=n.call(o,r),i.splice(s,1),s--}return e}),c.formatArgs.call(o,i),(a.log||c.log||console.log.bind(console)).apply(o,i)}}return a.namespace=e,a.enabled=c.enabled(e),a.useColors=c.useColors(),a.color=function(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return c.colors[Math.abs(n)%c.colors.length]}(e),a.destroy=o,"function"==typeof c.init&&c.init(a),c.instances.push(a),a}function o(){var e=c.instances.indexOf(this);return-1!==e&&(c.instances.splice(e,1),!0)}(c=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},c.disable=function(){c.enable("")},c.enable=function(e){var t;c.save(e),c.names=[],c.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(t=0;t<r;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?c.skips.push(new RegExp("^"+e.substr(1)+"$")):c.names.push(new RegExp("^"+e+"$")));for(t=0;t<c.instances.length;t++){var o=c.instances[t];o.enabled=c.enabled(o.namespace)}},c.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=c.skips.length;t<n;t++)if(c.skips[t].test(e))return!1;for(t=0,n=c.names.length;t<n;t++)if(c.names[t].test(e))return!0;return!1},c.humanize=t(80),c.instances=[],c.names=[],c.skips=[],c.formatters={}},function(e,t){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var n,r=o(e);if("string"===r&&0<e.length)return function(e){if(100<(e=String(e)).length)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"days":case"day":case"d":return 864e5*n;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*n;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*n;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===r&&!1===isNaN(e))return t.long?i(n=e,864e5,"day")||i(n,36e5,"hour")||i(n,6e4,"minute")||i(n,1e3,"second")||n+" ms":function(e){if(864e5<=e)return Math.round(e/864e5)+"d";if(36e5<=e)return Math.round(e/36e5)+"h";if(6e4<=e)return Math.round(e/6e4)+"m";if(1e3<=e)return Math.round(e/1e3)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(s,e,a){(function(n){var r=a(30),e=a(19);s.exports=t;var o,u=/\n/g,f=/\\n/g;function i(){}function t(e){r.call(this,e),this.query=this.query||{},o||(n.___eio||(n.___eio=[]),o=n.___eio),this.index=o.length;var t=this;o.push(function(e){t.onData(e)}),this.query.j=this.index,n.document&&n.addEventListener&&n.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=i)},!1)}e(t,r),t.prototype.supportsBinary=!1,t.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},t.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},t.prototype.doWrite=function(e,t){var n=this;if(!this.form){var r,o=document.createElement("form"),i=document.createElement("textarea"),s=this.iframeId="eio_iframe_"+this.index;o.className="socketio",o.style.position="absolute",o.style.top="-1000px",o.style.left="-1000px",o.target=s,o.method="POST",o.setAttribute("accept-charset","utf-8"),i.name="d",o.appendChild(i),document.body.appendChild(o),this.form=o,this.area=i}function a(){c(),t()}function c(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(e)}catch(e){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),c(),e=e.replace(f,"\\\n"),this.area.value=e.replace(u,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&a()}:this.iframe.onload=a}}).call(this,a(0))},function(l,e,h){(function(s){var t,n=h(24),a=h(9),r=h(18),e=h(19),o=h(33),c=h(20)("engine.io-client:websocket"),i=s.WebSocket||s.MozWebSocket;if("undefined"==typeof window)try{t=h(83)}catch(e){}var u=i;function f(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=i&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(u=t),n.call(this,e)}u||"undefined"!=typeof window||(u=t),e(l.exports=f,n),f.prototype.name="websocket",f.prototype.supportsBinary=!0,f.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?t?new u(e,t):new u(e):new u(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},f.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},f.prototype.write=function(e){var r=this;this.writable=!1;for(var o=e.length,t=0,n=o;t<n;t++)!function(n){a.encodePacket(n,r.supportsBinary,function(e){if(!r.usingBrowserWebSocket){var t={};if(n.options&&(t.compress=n.options.compress),r.perMessageDeflate)("string"==typeof e?s.Buffer.byteLength(e):e.length)<r.perMessageDeflate.threshold&&(t.compress=!1)}try{r.usingBrowserWebSocket?r.ws.send(e):r.ws.send(e,t)}catch(e){c("websocket closed before onclose event")}--o||i()})}(e[t]);function i(){r.emit("flush"),setTimeout(function(){r.writable=!0,r.emit("drain")},0)}},f.prototype.onClose=function(){n.prototype.onClose.call(this)},f.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},f.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=o()),this.supportsBinary||(e.b64=1),(e=r.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},f.prototype.check=function(){return!(!u||"__initialize"in u&&this.name===f.prototype.name)}}).call(this,h(0))},function(e,t){},function(e,t){e.exports=function(e,t){for(var n=[],r=(t=t||0)||0;r<e.length;r++)n[r-t]=e[r];return n}},function(e,t){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=0<e.jitter&&e.jitter<=1?e.jitter:0,this.attempts=0}(e.exports=n).prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}},function(e,t,c){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=c(5),d=c(3),r=function(e){function n(e,t){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(s=f(this,l(n).call(this,e)))._debug=c(2)("n2n:offline"),s.parent=t,s.on(d.signaling.RECEIVE_OFFER,function(e){var n=e.jobId,r=e.initiator,o=e.destination,t=e.type,i=e.offer;s._debug("[%s] receive an offline offer ",s.parent.id,{jobId:n,initiator:r,destination:o,type:t,offer:i}),s.parent.pendingInview.has(r)||"new"!==t?"new"===t?s.parent.pendingInview.has(r)?s.parent.pendingInview.get(r).socket.emit(d.socket.RECEIVE_OFFER,i):s.parent.livingInview.has(r)&&s.parent.livingInview.get(r).socket.emit(d.socket.RECEIVE_OFFER,i):"back"===t&&(s.parent.pendingOutview.has(o)?s.parent.pendingOutview.get(o).socket.emit(d.socket.RECEIVE_OFFER,i):s.parent.livingOutview.has(o)&&s.parent.livingOutview.get(o).socket.emit(d.socket.RECEIVE_OFFER,i)):(s.parent.createNewSocket(s.parent.options.socket,r,!1),s.parent.pendingInview.get(r).socket.on(d.socket.EMIT_OFFER,function(e){var t={jobId:n,initiator:r,destination:o,offer:e,type:"back"};s.sendOffer(t)}),s.parent.pendingInview.get(r).socket.on(d.socket.EMIT_OFFER_RENEGOCIATE,function(e){var t={jobId:n,initiator:r,destination:o,offer:e,offerType:"back"};s.parent.signaling.direct.sendOfferBackRenegociate(t)}),s.parent.pendingInview.get(r).socket.emit(d.socket.RECEIVE_OFFER,i))}),s}var t,r,o,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(n,p),t=n,(r=[{key:"connect",value:(a=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.emit("connect");case 1:case"end":return e.stop()}},e,this)}),i=function(){var e=this,s=arguments;return new Promise(function(t,n){var r=a.apply(e,s);function o(e){u(r,t,n,o,i,"next",e)}function i(e){u(r,t,n,o,i,"throw",e)}o(void 0)})},function(){return i.apply(this,arguments)})},{key:"sendOffer",value:function(e){this.emit(d.signaling.EMIT_OFFER,e)}}])&&s(t.prototype,r),o&&s(t,o),n}();e.exports=r},function(e,t,s){function a(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}e.exports=function(t){function n(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return u.colors[Math.abs(t)%u.colors.length]}function u(e){var a;function c(){for(var e=arguments.length,o=new Array(e),t=0;t<e;t++)o[t]=arguments[t];if(c.enabled){var i=c,n=Number(new Date),r=n-(a||n);i.diff=r,i.prev=a,i.curr=n,a=n,o[0]=u.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var s=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(e,t){if("%%"===e)return e;s++;var n=u.formatters[t];if("function"==typeof n){var r=o[s];e=n.call(i,r),o.splice(s,1),s--}return e}),u.formatArgs.call(i,o),(i.log||u.log).apply(i,o)}}return c.namespace=e,c.enabled=u.enabled(e),c.useColors=u.useColors(),c.color=n(e),c.destroy=r,c.extend=o,"function"==typeof u.init&&u.init(c),u.instances.push(c),c}function r(){var e=u.instances.indexOf(this);return-1!==e&&(u.instances.splice(e,1),!0)}function o(e,t){return u(this.namespace+(void 0===t?":":t)+e)}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return((u.debug=u).default=u).coerce=function(e){return e instanceof Error?e.stack||e.message:e},u.disable=function(){var e=a(u.names.map(i)).concat(a(u.skips.map(i).map(function(e){return"-"+e}))).join(",");return u.enable(""),e},u.enable=function(e){var t;u.save(e),u.names=[],u.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(t=0;t<r;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?u.skips.push(new RegExp("^"+e.substr(1)+"$")):u.names.push(new RegExp("^"+e+"$")));for(t=0;t<u.instances.length;t++){var o=u.instances[t];o.enabled=u.enabled(o.namespace)}},u.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=u.skips.length;t<n;t++)if(u.skips[t].test(e))return!1;for(t=0,n=u.names.length;t<n;t++)if(u.names[t].test(e))return!0;return!1},u.humanize=s(38),Object.keys(t).forEach(function(e){u[e]=t[e]}),u.instances=[],u.names=[],u.skips=[],u.formatters={},u.selectColor=n,u.enable(u.load()),u}},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function l(a){return function(){var e=this,s=arguments;return new Promise(function(t,n){var r=a.apply(e,s);function o(e){c(r,t,n,o,i,"next",e)}function i(e){c(r,t,n,o,i,"throw",e)}o(void 0)})}}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=n(5),v=n(3),m=n(2),b=n(4)(),o=function(e){function n(e,t){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(a=p(this,d(n).call(this,e))).parent=t,a._debug=m("n2n:bridge:io"),a.on(v.signaling.RECEIVE_OFFER,function(e){var n=e.jobId,r=e.initiator,o=e.destination,t=e.forward,i=e.offerType,s=e.offer;if(!(r&&o&&s&&i))throw new Error("PLEASE REPORT, Problem with the offline signaling service. provide at least initiator, destination, type a,d the offer as properties in the object received");a.parent.pendingInview.has(r)||"new"!==i?"new"===i?a.parent.pendingInview.has(r)?a.parent.pendingInview.get(r).socket.emit(v.socket.RECEIVE_OFFER,s):a.parent.livingInview.has(r)&&a.parent.livingInview.get(r).socket.emit(v.socket.RECEIVE_OFFER,s):"back"===i&&(a.parent.pendingOutview.has(o)?a.parent.pendingOutview.get(o).socket.emit(v.socket.RECEIVE_OFFER,s):a.parent.livingOutview.has(o)&&a.parent.livingOutview.get(o).socket.emit(v.socket.RECEIVE_OFFER,s)):(a.parent.createNewSocket(a.parent.options.socket,r,!1),a.parent.pendingInview.get(r).socket.on(v.socket.EMIT_OFFER,function(e){a.sendOfferBack({jobId:n,initiator:r,destination:o,forward:t,offer:e,offerType:"back"})}),a.parent.pendingInview.get(r).socket.on(v.socket.EMIT_OFFER_RENEGOCIATE,function(e){var t={jobId:n,initiator:r,destination:o,offer:e,offerType:"back"};a.parent.signaling.direct.sendOfferBackRenegociate(t)}),a.parent.pendingInview.get(r).socket.emit(v.socket.RECEIVE_OFFER,s))}),a}var t,r,o,i,s,a,c,u,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(n,y),t=n,(r=[{key:"connect",value:(f=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"sendOfferTo",value:(u=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.type=v.n2n.bridgeIO.BRIDGE_FORWARD,this._debug("[%s] send to forwarding peer: %s",this.parent.id,t.forward),this.parent.send(this.parent.options.n2n.protocol,t.forward,t,!0);case 3:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"sendOfferBack",value:(c=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.type=v.n2n.bridgeIO.BRIDGE_FORWARD_BACK,this._debug("[%s] send back the offer to the forwarding peer: %s",this.parent.id,t.forward,t),this.parent.send(this.parent.options.n2n.protocol,t.forward,t,!1);case 3:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"forward",value:(a=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.type=v.n2n.bridgeIO.BRIDGE_FORWARD_RESPONSE,this._debug("[%s] forwarding to %s",this.parent.id,t.destination,t,t.outview),this.parent.send(this.parent.options.n2n.protocol,t.destination,t,!0);case 3:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"forwardBack",value:(s=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.type=v.n2n.bridgeIO.BRIDGE_FORWARD_RESPONSE,this._debug("[%s] forwarding back to %s",this.parent.id,t.initiator,t,t.outview),this.parent.send(this.parent.options.n2n.protocol,t.initiator,t,!1);case 3:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"bridge",value:(i=l(regeneratorRuntime.mark(function e(o,i){var s,a=this,t=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=2<t.length&&void 0!==t[2]?t[2]:this.parent.options.n2n.timeout,e.abrupt("return",new Promise(function(t,n){if(a.parent.livingInview.has(o)&&a.parent.livingOutview.has(i)){var e=b.new(),r=setTimeout(function(){n(new Error("timeout"))},s);a.parent.events.once(e,function(e){clearTimeout(r),e.response?t():n(new Error("bridge rejected."))}),a.parent.send(a.parent.options.n2n.protocol,o,{type:v.n2n.bridgeIO.BRIDGE,from:o,dest:i,forward:a.parent.id,jobId:e},!1).catch(function(e){n(e)})}else n(new Error("[".concat(a.parent.id,"/bridgeOO] from need to be in our inview and dest in our outview")))}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"_bridge",value:function(e,t){var o=this,n=t.from,i=t.dest,s=t.forward,a=t.jobId,r=function(e){o.parent.send(o.parent.options.n2n.protocol,s,{type:v.n2n.RESPONSE,response:!0,jobId:a}).catch(function(e){console.error("cannot send response",e)})};if(this.parent.livingOutview.has(i))this.parent.increaseOccurences(i,!0).then(function(){r()}).catch(function(e){console.error("cannot increase occurences",e)});else if(this.parent.livingOutview.has(i)||this.parent.pendingOutview.has(i))if(!this.parent.livingOutview.has(i)&&this.parent.pendingOutview.has(i)){var c=setTimeout(function(){r(0,"pending connection has never been connected. (from: ".concat(n,", dest:").concat(i," forward: ").concat(s,")"))},this.parent.options.n2n.timeout);this.parent.pendingOutview.get(i).socket.once("connect",function(){clearTimeout(c),o.parent.connectFromUs(i).then(function(){r()}).catch(function(e){r(0,e.message)})})}else r();else new Promise(function(e,t){var n=setTimeout(function(){t(new Error("timeout"))},o.parent.options.n2n.timeout),r=o.parent.createNewSocket(o.parent.options.socket,i,!0);r.on("error",function(e){o.parent._manageError(e,i,!0,t,"bridgeIO")}),r.on(v.socket.EMIT_OFFER,function(e){var t={jobId:a,initiator:o.parent.id,destination:i,forward:s,offer:e,offerType:"new"};o.parent.signaling.bridgeIO.sendOfferTo(t)}),r.connect().then(function(){clearTimeout(n),e()}).catch(function(e){clearTimeout(n),t(e)})}).then(function(){r()}).catch(function(e){r()})}}])&&h(t.prototype,r),o&&h(t,o),n}();e.exports=o},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function l(a){return function(){var e=this,s=arguments;return new Promise(function(t,n){var r=a.apply(e,s);function o(e){c(r,t,n,o,i,"next",e)}function i(e){c(r,t,n,o,i,"throw",e)}o(void 0)})}}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=n(5),v=n(3),m=n(2),b=n(4)(),o=function(e){function n(e,t){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(a=p(this,d(n).call(this,e))).parent=t,a._debug=m("n2n:bridge:oo"),a.on(v.signaling.RECEIVE_OFFER,function(e){var n=e.jobId,r=e.initiator,o=e.destination,t=e.forward,i=e.offerType,s=e.offer;if(!(r&&o&&s&&i&&n&&t))throw new Error("PLEASE REPORT, Problem with the offline signaling service. provide at least jobId, initiator, destination, forward, offerType, offer");a.parent.pendingInview.has(r)||"new"!==i?"new"===i?a.parent.pendingInview.has(r)?a.parent.pendingInview.get(r).socket.emit(v.socket.RECEIVE_OFFER,s):a.parent.livingInview.has(r)&&a.parent.livingInview.get(r).socket.emit(v.socket.RECEIVE_OFFER,s):"back"===i&&(a.parent.pendingOutview.has(o)?a.parent.pendingOutview.get(o).socket.emit(v.socket.RECEIVE_OFFER,s):a.parent.livingOutview.has(o)&&a.parent.livingOutview.get(o).socket.emit(v.socket.RECEIVE_OFFER,s)):(a.parent.createNewSocket(a.parent.options.socket,r,!1),a.parent.pendingInview.get(r).socket.on(v.socket.EMIT_OFFER,function(e){a.sendOfferBack({jobId:n,initiator:r,destination:o,forward:t,offer:e,offerType:"back"})}),a.parent.pendingInview.get(r).socket.on(v.socket.EMIT_OFFER_RENEGOCIATE,function(e){var t={jobId:n,initiator:r,destination:o,offer:e,offerType:"back"};a.parent.signaling.direct.sendOfferBackRenegociate(t)}),a.parent.pendingInview.get(r).socket.emit(v.socket.RECEIVE_OFFER,s))}),a}var t,r,o,i,s,a,c,u,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(n,y),t=n,(r=[{key:"connect",value:(f=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"sendOfferTo",value:(u=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.type=v.n2n.bridgeOO.BRIDGE_FORWARD,this._debug("[%s] send to forwarding peer: %s",this.parent.id,t.forward),this.parent.send(this.parent.options.n2n.protocol,t.forward,t,!1);case 3:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"sendOfferBack",value:(c=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.type=v.n2n.bridgeOO.BRIDGE_FORWARD_BACK,this._debug("[%s] send back the offer to the forwarding peer: %s",this.parent.id,t.forward,t),this.parent.send(this.parent.options.n2n.protocol,t.forward,t,!1);case 3:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"forward",value:(a=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.type=v.n2n.bridgeOO.BRIDGE_FORWARD_RESPONSE,this._debug("[%s] forwarding to %s",this.parent.id,t.destination,t),this.parent.send(this.parent.options.n2n.protocol,t.destination,t,!0);case 3:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"forwardBack",value:(s=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.type=v.n2n.bridgeOO.BRIDGE_FORWARD_RESPONSE,this._debug("[%s] forwarding back to %s",this.parent.id,t.initiator,t),this.parent.send(this.parent.options.n2n.protocol,t.initiator,t,!0);case 3:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"bridge",value:(i=l(regeneratorRuntime.mark(function e(i,s){var a,c=this,t=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=2<t.length&&void 0!==t[2]?t[2]:this.parent.options.n2n.timeout,e.abrupt("return",new Promise(function(t,n){if(c.parent.livingOutview.has(i))if(c.parent.livingOutview.has(s)){var r=b.new(),o=setTimeout(function(){n(new Error("[".concat(c.parent.id,"/bridge00] (jobId=").concat(r,") connection timeout(").concat(a," (ms)) from ").concat(i," to ").concat(s)))},a);c._debug("[".concat(c.parent.id,"/bridge00] waiting response for jobId:").concat(r," ")),c.parent.events.once(r,function(e){clearTimeout(o),c._debug("[".concat(c.parent.id,"/bridge00] receive response for jobId:").concat(r," ")),e.response?t():n(new Error("bridge rejected. Reason: "+e.reason))}),c.parent.send(c.parent.options.n2n.protocol,i,{type:v.n2n.bridgeOO.BRIDGE,from:i,dest:s,forward:c.parent.id,jobId:r},!0).catch(function(e){console.error("cannot send a bridge request to "+i,e),clearTimeout(o),n(e)})}else n(new Error("[".concat(c.parent.id,"/bridgeOO] peerId is not in our outview: ").concat(s)));else n(new Error("[".concat(c.parent.id,"/bridgeOO] peerId is not in our outview: ").concat(i)))}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"_bridge",value:function(e,t){var o=this,n=t.from,i=t.dest,s=t.forward,a=t.jobId,r=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"none";o.parent.send(o.parent.options.n2n.protocol,s,{type:v.n2n.RESPONSE,response:e,reason:t,jobId:a},!1).then(function(){o._debug("[".concat(o.parent.id,"] response sent for jobId=").concat(a))}).catch(function(e){console.error("[".concat(o.parent.id,"] cannot send response for jobId=").concat(a," to id=").concat(s),e)})};if(this.parent.livingOutview.has(i))this.parent.increaseOccurences(i,!0).then(function(){r(!0)}).catch(function(e){console.error("cannot increase occurences",e),r(!1,e.message)});else if(this.parent.livingOutview.has(i)||this.parent.pendingOutview.has(i)){var c=setTimeout(function(){r(!1,"pending connection has never been connected. (from: ".concat(n,", dest:").concat(i," forward: ").concat(s,")"))},this.parent.options.n2n.timeout);this.parent.pendingOutview.get(i).socket.once("connect",function(){clearTimeout(c),o.parent.connectFromUs(i).then(function(){r(!0)}).catch(function(e){r(!1,e.message)})})}else{new Promise(function(e,t){var n=setTimeout(function(){t(new Error("[_bridgeOO] timeout"+!1))},o.parent.options.n2n.timeout),r=o.parent.createNewSocket(o.parent.options.socket,i,!0);r.on("error",function(e){o.parent._manageError(e,i,!0,t,"bridgeOO")}),r.on(v.socket.EMIT_OFFER,function(e){var t={jobId:a,initiator:o.parent.id,destination:i,forward:s,offer:e,offerType:"new"};o.sendOfferTo(t)}),r.connect().then(function(){clearTimeout(n),e()}).catch(function(e){clearTimeout(n),t(e)})}).then(function(){r(!0)}).catch(function(e){r(!1,e.message)})}}}])&&h(t.prototype,r),o&&h(t,o),n}();e.exports=o},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function l(a){return function(){var e=this,s=arguments;return new Promise(function(t,n){var r=a.apply(e,s);function o(e){c(r,t,n,o,i,"next",e)}function i(e){c(r,t,n,o,i,"throw",e)}o(void 0)})}}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=n(5),v=n(3),m=n(2),b=n(4)(),o=function(e){function n(e,t){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(a=p(this,d(n).call(this,e))).parent=t,a._debug=m("n2n:bridge:oi"),a.on(v.signaling.RECEIVE_OFFER,function(e){var n=e.jobId,r=e.initiator,o=e.destination,t=e.forward,i=e.offerType,s=e.offer;if(!(r&&o&&s&&i))throw new Error("PLEASE REPORT, Problem with the offline signaling service. provide at least initiator, destination, type a,d the offer as properties in the object received");a.parent.pendingInview.has(r)||"new"!==i?"new"===i?a.parent.pendingInview.has(r)?a.parent.pendingInview.get(r).socket.emit(v.socket.RECEIVE_OFFER,s):a.parent.livingInview.has(r)&&a.parent.livingInview.get(r).socket.emit(v.socket.RECEIVE_OFFER,s):"back"===i&&(a.parent.pendingOutview.has(o)?a.parent.pendingOutview.get(o).socket.emit(v.socket.RECEIVE_OFFER,s):a.parent.livingOutview.has(o)&&a.parent.livingOutview.get(o).socket.emit(v.socket.RECEIVE_OFFER,s)):(a.parent.createNewSocket(a.parent.options.socket,r,!1),a.parent.pendingInview.get(r).socket.on(v.socket.EMIT_OFFER,function(e){a.sendOfferBack({jobId:n,initiator:r,destination:o,forward:t,offer:e,offerType:"back"})}),a.parent.pendingInview.get(r).socket.on(v.socket.EMIT_OFFER_RENEGOCIATE,function(e){var t={jobId:n,initiator:r,destination:o,offer:e,offerType:"back"};a.parent.signaling.direct.sendOfferBackRenegociate(t)}),a.parent.pendingInview.get(r).socket.emit(v.socket.RECEIVE_OFFER,s))}),a}var t,r,o,i,s,a,c,u,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(n,y),t=n,(r=[{key:"connect",value:(f=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"sendOfferTo",value:(u=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.type=v.n2n.bridgeOI.BRIDGE_FORWARD,this._debug("[%s] send to forwarding peer: %s",this.parent.id,t.forward),this.parent.send(this.parent.options.n2n.protocol,t.forward,t,!1);case 3:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"sendOfferBack",value:(c=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.type=v.n2n.bridgeOI.BRIDGE_FORWARD_BACK,this._debug("[%s] send back the offer to the forwarding peer: %s",this.parent.id,t.forward,t),this.parent.send(this.parent.options.n2n.protocol,t.forward,t,!0);case 3:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"forward",value:(a=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.type=v.n2n.bridgeOI.BRIDGE_FORWARD_RESPONSE,this._debug("[%s] forwarding to %s",this.parent.id,t.destination,t),this.parent.send(this.parent.options.n2n.protocol,t.destination,t,!1);case 3:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"forwardBack",value:(s=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.type=v.n2n.bridgeOI.BRIDGE_FORWARD_RESPONSE,this._debug("[%s] forwarding back to %s",this.parent.id,t.initiator,t),this.parent.send(this.parent.options.n2n.protocol,t.initiator,t,!0);case 3:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"bridge",value:(i=l(regeneratorRuntime.mark(function e(o,i){var s,a=this,t=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=2<t.length&&void 0!==t[2]?t[2]:this.parent.options.n2n.timeout,e.abrupt("return",new Promise(function(t,n){if(a.parent.livingOutview.has(o)&&a.parent.livingInview.has(i)){var e=b.new(),r=setTimeout(function(){n(new Error("timeout"))},s);a.parent.events.once(e,function(e){clearTimeout(r),e.response?t():n(new Error("bridge rejected."))}),a.parent.send(a.parent.options.n2n.protocol,o,{type:v.n2n.bridgeOI.BRIDGE,from:o,dest:i,forward:a.parent.id,jobId:e},!0).catch(function(e){n(e)})}else a.parent.livingOutview.has(i)||n(new Error("[".concat(a.parent.id,"/bridgeOO] from need to be in our outview and dest in our inview")))}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"_bridge",value:function(e,t){var o=this,n=t.from,i=t.dest,s=t.forward,a=t.jobId,r=function(e){o.parent.send(o.parent.options.n2n.protocol,s,{type:v.n2n.RESPONSE,response:e,jobId:a},!1).catch(function(e){console.error("cannot send response",e)})};if(this.parent.livingOutview.has(i))this.parent.increaseOccurences(i,!0).then(function(){r(!0)}).catch(function(e){console.error("cannot increase occurences",e),r(!1)});else if(this.parent.livingOutview.has(i)||this.parent.pendingOutview.has(i))if(!this.parent.livingOutview.has(i)&&this.parent.pendingOutview.has(i)){var c=setTimeout(function(){r(!1,"pending connection has never been connected. (from: ".concat(n,", dest:").concat(i," forward: ").concat(s,")"))},this.parent.options.n2n.timeout);this.parent.pendingOutview.get(i).socket.once("connect",function(){clearTimeout(c),o.parent.connectFromUs(i).then(function(){r(!0)}).catch(function(e){r(!1,e.message)})})}else r(!1);else new Promise(function(e,t){var n=setTimeout(function(){t(new Error("timeout"))},o.parent.options.n2n.timeout),r=o.parent.createNewSocket(o.parent.options.socket,i,!0);r.on("error",function(e){o.parent._manageError(e,i,!0,t,"bridgeOI")}),r.on(v.socket.EMIT_OFFER,function(e){var t={initiator:o.parent.id,destination:i,forward:s,offer:e,jobId:a,offerType:"new"};o.sendOfferTo(t)}),r.connect().then(function(){clearTimeout(n),e()}).catch(function(e){clearTimeout(n),t(e)})}).then(function(){r(!0)}).catch(function(e){r(!1)})}}])&&h(t.prototype,r),o&&h(t,o),n}();e.exports=o},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function l(a){return function(){var e=this,s=arguments;return new Promise(function(t,n){var r=a.apply(e,s);function o(e){c(r,t,n,o,i,"next",e)}function i(e){c(r,t,n,o,i,"throw",e)}o(void 0)})}}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=n(5),v=n(3),m=n(2),b=n(16),w=n(4)(),o=function(e){function n(e,t){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(s=p(this,d(n).call(this,e))).parent=t,s._debug=m("n2n:direct"),s.on(v.signaling.RECEIVE_OFFER,function(e){var n=e.jobId,r=e.initiator,o=e.destination,t=e.offerType,i=e.offer;if(s._debug("[%s][%s] receive an offer from %s: ",s.parent.id,n,r,i),!(r&&o&&i&&t))throw new Error("PLEASE REPORT, Problem with the offline signaling service. provide at least initiator, destination, type a,d the offer as properties in the object received");s.parent.pendingInview.has(r)||"new"!==t?"new"===t?s.parent.pendingInview.has(r)?s.parent.pendingInview.get(r).socket.emit(v.socket.RECEIVE_OFFER,i):s.parent.livingInview.has(r)&&s.parent.livingInview.get(r).socket.emit(v.socket.RECEIVE_OFFER,i):"back"===t&&(s.parent.pendingOutview.has(o)?s.parent.pendingOutview.get(o).socket.emit(v.socket.RECEIVE_OFFER,i):s.parent.livingOutview.has(o)&&s.parent.livingOutview.get(o).socket.emit(v.socket.RECEIVE_OFFER,i)):(s.parent.createNewSocket(s.parent.options.socket,r,!1),s.parent.pendingInview.get(r).socket.on(v.socket.EMIT_OFFER,function(e){var t={jobId:n,initiator:r,destination:o,offer:e,offerType:"back"};s.sendOfferBack(t)}),s.parent.pendingInview.get(r).socket.on(v.socket.EMIT_OFFER_RENEGOCIATE,function(e){var t={jobId:n,initiator:r,destination:o,offer:e,offerType:"back"};s.sendOfferBackRenegociate(t)}),s.parent.pendingInview.get(r).socket.emit(v.socket.RECEIVE_OFFER,i))}),s}var t,r,o,i,s,a,c,u,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(n,y),t=n,(r=[{key:"connect",value:(f=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"sendOfferTo",value:(u=l(regeneratorRuntime.mark(function e(t){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.type=v.n2n.DIRECT_TO,this.parent.send(this.parent.options.n2n.protocol,t.destination,t,!1).then(function(){n._debug("[%s] send to direct peer: %s",n.parent.id,t.destination,t)}).catch(function(e){console.error("[%s] send to direct, error",n.parent.id,e)});case 2:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"sendOfferBack",value:(c=l(regeneratorRuntime.mark(function e(t){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.type=v.n2n.DIRECT_BACK,this._debug("[%s] send back the offer to the direct peer: %s",this.parent.id,t.initiator,t),this.parent.send(this.parent.options.n2n.protocol,t.initiator,t).catch(function(e){console.error("[%s] send back to direct, error",n.parent.id,e)});case 3:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"sendOfferBackRenegociate",value:(a=l(regeneratorRuntime.mark(function e(t){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.type=v.n2n.DIRECT_BACK,this._debug("[%s][RENEGOCIATE]send back the offer to the direct peer: %s",this.parent.id,t.initiator,t),this.parent.send(this.parent.options.n2n.protocol,t.initiator,t,!1).catch(function(e){console.error("[%s] send back to direct, error",n.parent.id,e)});case 3:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"connectToUs",value:(s=l(regeneratorRuntime.mark(function e(i){var s,a,c=this,t=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=1<t.length&&void 0!==t[1]?t[1]:this.parent.options.n2n.timeout,a=!(2<t.length&&void 0!==t[2])||t[2],!this.parent.livingOutview.has(i)&&a||!this.parent.livingInview.has(i)&&!a)throw b.peerNotFound(i);e.next=6;break;case 6:return e.abrupt("return",new Promise(function(t,n){var r=w.new(),o=setTimeout(function(){var e=new Error("timed out (".concat(s," (ms)) jobId= ").concat(r,". Cannot establish a connection between us and ").concat(i));console.error(e),n(e)},s);c.parent.events.once(r,function(e){e.response?(clearTimeout(o),t()):(clearTimeout(o),n(new Error("Connection could be established. Something wrong happened. Reason: "+e.reason)))}),c.parent.send(c.parent.options.n2n.protocol,i,{type:v.n2n.CONNECT_TO_US,jobId:r,outview:a,id:c.parent.id},a).then(function(){c._debug("[%s][%s] connectToUs message sent to %s to connect to US..",c.parent.id,r,i)}).catch(function(e){clearTimeout(o),console.error(e),n(e)})}));case 7:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"_connectToUs",value:(i=l(regeneratorRuntime.mark(function e(t){var i,s,a,c,n,u=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=t.id,s=t.jobId,a=t.outview,this._debug("[%s][%s][_connectToUs] receive a connectToUs order from %s...",this.parent.id,s,i),c=i,n=function(t,e){u.parent.send(u.parent.options.n2n.protocol,c,{type:v.n2n.RESPONSE,response:t,reason:e,jobId:s},!a).then(function(){u._debug("[%s][%s][_connectToUs] send response to %s :",u.parent.id,s,i,t,a)}).catch(function(e){u._debug("[%s][%s][_connectToUs] cannot send response to %s :",u.parent.id,s,i,t,a)})},function(){return new Promise(function(e,t){if(u.parent.livingOutview.has(c)||!u.parent.livingInview.has(c)||u.parent.pendingOutview.has(c))if(u.parent.livingOutview.has(c)&&u.parent.livingInview.has(c))u._debug("[%s][%s][_connectToUs] the peer is in our outview so, just increase occurences %s...",u.parent.id,s,i),u.parent.connectFromUs(c).then(function(){u._debug("[%s][%s][_connectToUs] Increase occurences has been done ...",u.parent.id,s,i),e()}).catch(function(e){u._debug("[%s][%s][_connectToUs] Increase occurences has crashed ...",u.parent.id,s,i),t(e)});else if(!u.parent.livingOutview.has(c)&&u.parent.livingInview.has(c)&&u.parent.pendingOutview.has(c)){var n=setTimeout(function(){t(new Error("pending connection has never been connected."))},u.parent.options.n2n.timeout);u.parent.pendingOutview.get(c).socket.once("connect",function(){clearTimeout(n),u.parent.connectFromUs(c).then(function(){u._debug("[%s][%s][_connectToUs/afterpending] Increase occurences has been done ...",u.parent.id,s,i),e()}).catch(function(e){u._debug("[%s][%s][_connectToUs/afterpending] Increase occurences has crashed ...",u.parent.id,s,i),t(e)})})}else a||!u.parent.livingOutview.has(c)||u.parent.livingInview.has(c)?t(new Error("ConnectToUs errored, case not handled.")):(u._debug("[%s][%s][_connectToUs] the peer is in our outview so, just increase occurences %s...",u.parent.id,s,i),u.parent.connectFromUs(c).then(function(){u._debug("[%s][%s][_connectToUs] Increase occurences has been done ...",u.parent.id,s,i),e()}).catch(function(e){u._debug("[%s][%s][_connectToUs] Increase occurences has crashed ...",u.parent.id,s,i),t(e)}));else{var r=setTimeout(function(){t(new Error("[".concat(u.parent.id,"][").concat(s,"][to=").concat(i,"] timeout")))},u.parent.options.n2n.timeout),o=u.parent.createNewSocket(u.parent.options.socket,c,!0);o.on("error",function(e){u.parent._manageError(e,c,!0,function(e){u._debug("[%s][%s][_connectToUs] receive an error during the connection %s...",u.parent.id,s,i,e),t(e)},"direct")}),o.on(v.socket.EMIT_OFFER,function(e){var t={jobId:s,initiator:u.parent.id,destination:c,offer:e,offerType:"new"};u.sendOfferTo(t)}),o.connect().then(function(){clearTimeout(r),e()}).catch(function(e){clearTimeout(r),t(e)})}})}().then(function(){n(!0)}).catch(function(e){u._debug("[%s][%s][_connectToUs] is errored %s...",u.parent.id,s,i,e),n(!1,e.message)});case 6:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})}])&&h(t.prototype,r),o&&h(t,o),n}();e.exports=o},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function a(e,t,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function c(e){var r="function"==typeof Map?new Map:void 0;return(c=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,n)}function n(){return o(e,arguments,f(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),u(n,e)})(e)}function o(e,t,n){return(o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&u(o,n.prototype),o}).apply(null,arguments)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var r=function(e){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),s(this,f(n).apply(this,arguments))}var t,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(n,c(Map)),t=n,(r=[{key:"available",value:function(e){if(a(f(n.prototype),"has",this).call(this,e)){var t=a(f(n.prototype),"get",this).call(this,e);return 0<t.occurences-t.lock&&"connected"===t.socket.status}return!1}}])&&i(t.prototype,r),o&&i(t,o),n}();e.exports=r},function(e,t,n){e.exports={abstract:n(39),simplepeer:n(96),moc:n(46)}},function(e,t,n){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(95),s=n(12).Buffer;e.exports=function e(t){if(null===t||"object"!==o(t))return"string"==typeof t?t.length*i.STRING:"boolean"==typeof t?i.BOOLEAN:"number"==typeof t?i.NUMBER:0;if(s.isBuffer(t))return t.length;var n=0;for(var r in t)if(Object.hasOwnProperty.call(t,r)){n+=e(r);try{n+=e(t[r])}catch(e){e instanceof RangeError&&(n=0)}}return n}},function(e,t){e.exports={STRING:2,BOOLEAN:4,NUMBER:8}},function(e,t,a){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function u(a){return function(){var e=this,s=arguments;return new Promise(function(t,n){var r=a.apply(e,s);function o(e){c(r,t,n,o,i,"next",e)}function i(e){c(r,t,n,o,i,"throw",e)}o(void 0)})}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=a(39),g=a(15),y=a(97),r=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=g({moc:!1,MocClass:a(46),trickle:!0,initiator:!1,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]}},e),l(this,h(t).call(this,e))}var n,r,o,i,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,d),n=t,(r=[{key:"_receiveOffer",value:function(e){this.statistics.offerReceived++,this._debug("[socket:%s] the socket just received an offer (status=%s)",this.socketId,this.status,this.statistics,this.options.initiator,e),this._create(),this.__socket.signal(e)}},{key:"_create",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options;e.initiator=!1,this.__socket||(this.options.moc?this.__socket=new this.options.MocClass(e):this.__socket=new y(e),this.status="connecting",this.__socket.once("connect",function(){t.signalConnect()}),this.__socket.on("signal",function(e){t.emitOffer(e)}),this.__socket.on("close",function(){"disconnected"!==t.status&&t.signalDisconnect()}),this.__socket.on("error",function(e){t.__socket.destroy(e),t._manageErrors(e)}),this.__socket.on("data",function(){t._receiveData.apply(t,arguments)}))}},{key:"_connect",value:function(){var r=this,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options.socket;return o.initiator=!0,this._debug("Options for the new socket: ",o),new Promise(function(){var n=u(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o.moc?r.__socket=new r.options.MocClass(o):r.__socket=new y(o),r.__socket.on("signal",function(e){r.emitOffer(e)}),r.__socket.once("connect",function(){r.signalConnect(),t()}),r.__socket.once("error",function(e){r.__socket.destroy(e),r._manageErrors(e)}),r.__socket.on("data",function(){r._receiveData.apply(r,arguments)}),r.__socket.once("close",function(){"disconnected"!==r.status&&r.signalDisconnect()});case 6:case"end":return e.stop()}},e,this)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"_send",value:(s=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._create(),e.prev=1,this.__socket.send(t),e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(1),e.t0;case 8:case"end":return e.stop()}},e,this,[[1,5]])})),function(e){return s.apply(this,arguments)})},{key:"_disconnect",value:(i=u(regeneratorRuntime.mark(function e(){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){n.__socket.once("close",function(){e()}),n.__socket.destroy()}));case 1:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})}])&&f(n.prototype,r),o&&f(n,o),t}();e.exports=r},function(f,e,l){(function(n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}f.exports=a;var t=l(98)("simple-peer"),o=l(100),e=l(10),i=l(101),s=l(102);function a(e){var t=this;if(!(t instanceof a))return new a(e);if(t._id=i(4).toString("hex").slice(0,7),t._debug("new peer %o",e),e=Object.assign({allowHalfOpen:!1},e),s.Duplex.call(t,e),t.channelName=e.initiator?e.channelName||i(20).toString("hex"):null,t._isChromium="undefined"!=typeof window&&!!window.webkitRTCPeerConnection,t.initiator=e.initiator||!1,t.channelConfig=e.channelConfig||a.channelConfig,t.config=e.config||a.config,t.constraints=t._transformConstraints(e.constraints||a.constraints),t.offerConstraints=t._transformConstraints(e.offerConstraints||{}),t.answerConstraints=t._transformConstraints(e.answerConstraints||{}),t.sdpTransform=e.sdpTransform||function(e){return e},t.streams=e.streams||(e.stream?[e.stream]:[]),t.trickle=void 0===e.trickle||e.trickle,t.destroyed=!1,t.connected=!1,t.remoteAddress=void 0,t.remoteFamily=void 0,t.remotePort=void 0,t.localAddress=void 0,t.localPort=void 0,t._wrtc=e.wrtc&&"object"===r(e.wrtc)?e.wrtc:o(),!t._wrtc)throw"undefined"==typeof window?u("No WebRTC support: Specify `opts.wrtc` option in this environment","ERR_WEBRTC_SUPPORT"):u("No WebRTC support: Not a supported browser","ERR_WEBRTC_SUPPORT");t._pcReady=!1,t._channelReady=!1,t._iceComplete=!1,t._channel=null,t._pendingCandidates=[],t._isNegotiating=!1,t._batchedNegotiation=!1,t._queuedNegotiation=!1,t._sendersAwaitingStable=[],t._senderMap=new WeakMap,t._remoteTracks=[],t._remoteStreams=[],t._chunk=null,t._cb=null,t._interval=null,t._pc=new t._wrtc.RTCPeerConnection(t.config,t.constraints),t._isReactNativeWebrtc="number"==typeof t._pc._peerConnectionId,t._pc.oniceconnectionstatechange=function(){t._onIceStateChange()},t._pc.onicegatheringstatechange=function(){t._onIceStateChange()},t._pc.onsignalingstatechange=function(){t._onSignalingStateChange()},t._pc.onicecandidate=function(e){t._onIceCandidate(e)},t.initiator?t._setupData({channel:t._pc.createDataChannel(t.channelName,t.channelConfig)}):t._pc.ondatachannel=function(e){t._setupData(e)},"addTrack"in t._pc&&(t.streams&&t.streams.forEach(function(e){t.addStream(e)}),t._pc.ontrack=function(e){t._onTrack(e)}),t.initiator&&t._needsNegotiation(),t._onFinishBound=function(){t._onFinish()},t.once("finish",t._onFinishBound)}function u(e,t){var n=new Error(e);return n.code=t,n}function c(){}e(a,s.Duplex),a.WEBRTC_SUPPORT=!!o(),a.config={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]},a.constraints={},a.channelConfig={},Object.defineProperty(a.prototype,"bufferSize",{get:function(){return this._channel&&this._channel.bufferedAmount||0}}),a.prototype.address=function(){return{port:this.localPort,family:"IPv4",address:this.localAddress}},a.prototype.signal=function(t){var n=this;if(n.destroyed)throw u("cannot signal after peer is destroyed","ERR_SIGNALING");if("string"==typeof t)try{t=JSON.parse(t)}catch(e){t={}}n._debug("signal()"),t.renegotiate&&(n._debug("got request to renegotiate"),n._needsNegotiation()),t.candidate&&(n._pc.remoteDescription&&n._pc.remoteDescription.type?n._addIceCandidate(t.candidate):n._pendingCandidates.push(t.candidate)),t.sdp&&n._pc.setRemoteDescription(new n._wrtc.RTCSessionDescription(t),function(){n.destroyed||(n._pendingCandidates.forEach(function(e){n._addIceCandidate(e)}),n._pendingCandidates=[],"offer"===n._pc.remoteDescription.type&&n._createAnswer())},function(e){n.destroy(u(e,"ERR_SET_REMOTE_DESCRIPTION"))}),t.sdp||t.candidate||t.renegotiate||n.destroy(u("signal() called with invalid signal data","ERR_SIGNALING"))},a.prototype._addIceCandidate=function(e){var t=this;try{t._pc.addIceCandidate(new t._wrtc.RTCIceCandidate(e),c,function(e){t.destroy(u(e,"ERR_ADD_ICE_CANDIDATE"))})}catch(e){t.destroy(u("error adding candidate: "+e.message,"ERR_ADD_ICE_CANDIDATE"))}},a.prototype.send=function(e){this._channel.send(e)},a.prototype.addStream=function(t){var n=this;n._debug("addStream()"),t.getTracks().forEach(function(e){n.addTrack(e,t)})},a.prototype.addTrack=function(e,t){this._debug("addTrack()");var n=this._pc.addTrack(e,t),r=this._senderMap.get(e)||new WeakMap;r.set(t,n),this._senderMap.set(e,r),this._needsNegotiation()},a.prototype.removeTrack=function(e,t){var n=this;n._debug("removeSender()");var r=n._senderMap.get(e),o=r?r.get(t):null;o||n.destroy(new Error("Cannot remove track that was never added."));try{n._pc.removeTrack(o)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?n._sendersAwaitingStable.push(o):n.destroy(e)}},a.prototype.removeStream=function(t){var n=this;n._debug("removeSenders()"),t.getTracks().forEach(function(e){n.removeTrack(e,t)})},a.prototype._needsNegotiation=function(){var e=this;e._debug("_needsNegotiation"),e._batchedNegotiation||(e._batchedNegotiation=!0,setTimeout(function(){e._batchedNegotiation=!1,e._debug("starting batched negotiation"),e.negotiate()},0))},a.prototype.negotiate=function(){this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),this._createOffer()):(this._debug("requesting negotiation from initiator"),this.emit("signal",{renegotiate:!0})),this._isNegotiating=!0},a.prototype.destroy=function(e){this._destroy(e,function(){})},a.prototype._destroy=function(e,t){var n=this;if(!n.destroyed){if(n._debug("destroy (error: %s)",e&&(e.message||e)),n.readable=n.writable=!1,n._readableState.ended||n.push(null),n._writableState.finished||n.end(),n.destroyed=!0,n.connected=!1,n._pcReady=!1,n._channelReady=!1,n._remoteTracks=null,n._remoteStreams=null,n._senderMap=null,clearInterval(n._interval),n._interval=null,n._chunk=null,n._cb=null,n._onFinishBound&&n.removeListener("finish",n._onFinishBound),n._onFinishBound=null,n._channel){try{n._channel.close()}catch(e){}n._channel.onmessage=null,n._channel.onopen=null,n._channel.onclose=null,n._channel.onerror=null}if(n._pc){try{n._pc.close()}catch(e){}n._pc.oniceconnectionstatechange=null,n._pc.onicegatheringstatechange=null,n._pc.onsignalingstatechange=null,n._pc.onicecandidate=null,"addTrack"in n._pc&&(n._pc.ontrack=null),n._pc.ondatachannel=null}n._pc=null,n._channel=null,e&&n.emit("error",e),n.emit("close"),t()}},a.prototype._setupData=function(e){var t=this;if(!e.channel)return t.destroy(u("Data channel event is missing `channel` property","ERR_DATA_CHANNEL"));t._channel=e.channel,t._channel.binaryType="arraybuffer","number"==typeof t._channel.bufferedAmountLowThreshold&&(t._channel.bufferedAmountLowThreshold=65536),t.channelName=t._channel.label,t._channel.onmessage=function(e){t._onChannelMessage(e)},t._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},t._channel.onopen=function(){t._onChannelOpen()},t._channel.onclose=function(){t._onChannelClose()},t._channel.onerror=function(e){t.destroy(u(e,"ERR_DATA_CHANNEL"))}},a.prototype._read=function(){},a.prototype._write=function(e,t,n){var r=this;if(r.destroyed)return n(u("cannot write after peer is destroyed","ERR_DATA_CHANNEL"));if(r.connected){try{r.send(e)}catch(e){return r.destroy(u(e,"ERR_DATA_CHANNEL"))}65536<r._channel.bufferedAmount?(r._debug("start backpressure: bufferedAmount %d",r._channel.bufferedAmount),r._cb=n):n(null)}else r._debug("write before connect"),r._chunk=e,r._cb=n},a.prototype._onFinish=function(){var e=this;function t(){setTimeout(function(){e.destroy()},1e3)}e.destroyed||(e.connected?t():e.once("connect",t))},a.prototype._createOffer=function(){var n=this;n.destroyed||n._pc.createOffer(function(t){function e(){var e=n._pc.localDescription||t;n._debug("signal"),n.emit("signal",{type:e.type,sdp:e.sdp})}n.destroyed||(t.sdp=n.sdpTransform(t.sdp),n._pc.setLocalDescription(t,function(){if(n._debug("createOffer success"),n.destroyed)return;n.trickle||n._iceComplete?e():n.once("_iceComplete",e)},function(e){n.destroy(u(e,"ERR_SET_LOCAL_DESCRIPTION"))}))},function(e){n.destroy(u(e,"ERR_CREATE_OFFER"))},n.offerConstraints)},a.prototype._createAnswer=function(){var n=this;n.destroyed||n._pc.createAnswer(function(t){function e(){var e=n._pc.localDescription||t;n._debug("signal"),n.emit("signal",{type:e.type,sdp:e.sdp})}n.destroyed||(t.sdp=n.sdpTransform(t.sdp),n._pc.setLocalDescription(t,function(){if(n.destroyed)return;n.trickle||n._iceComplete?e():n.once("_iceComplete",e)},function(e){n.destroy(u(e,"ERR_SET_LOCAL_DESCRIPTION"))}))},function(e){n.destroy(u(e,"ERR_CREATE_ANSWER"))},n.answerConstraints)},a.prototype._onIceStateChange=function(){if(!this.destroyed){var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(u("Ice connection failed.","ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(new Error("Ice connection closed."))}},a.prototype.getStats=function(n){var t=this;0===t._pc.getStats.length?t._pc.getStats().then(function(e){var t=[];e.forEach(function(e){t.push(e)}),n(null,t)},function(e){n(e)}):t._isReactNativeWebrtc?t._pc.getStats(null,function(e){var t=[];e.forEach(function(e){t.push(e)}),n(null,t)},function(e){n(e)}):0<t._pc.getStats.length?t._pc.getStats(function(e){if(!t.destroyed){var r=[];e.result().forEach(function(t){var n={};t.names().forEach(function(e){n[e]=t.stat(e)}),n.id=t.id,n.type=t.type,n.timestamp=t.timestamp,r.push(n)}),n(null,r)}},function(e){n(e)}):n(null,[])},a.prototype._maybeReady=function(){var c=this;c._debug("maybeReady pc %s channel %s",c._pcReady,c._channelReady),!c.connected&&!c._connecting&&c._pcReady&&c._channelReady&&(c._connecting=!0,function a(){c.destroyed||c.getStats(function(e,t){if(!c.destroyed){e&&(t=[]);var r={},o={},n={},i=!1;if(t.forEach(function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(r[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(o[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(n[e.id]=e)}),t.forEach(function(e){"transport"===e.type&&e.selectedCandidatePairId&&s(n[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&s(e)}),i||Object.keys(n).length&&!Object.keys(o).length){if(c._connecting=!1,c.connected=!0,c._chunk){try{c.send(c._chunk)}catch(e){return c.destroy(u(e,"ERR_DATA_CHANNEL"))}c._chunk=null,c._debug('sent chunk from "write before connect"'),(0,c._cb)(c._cb=null)}"number"!=typeof c._channel.bufferedAmountLowThreshold&&(c._interval=setInterval(function(){c._onInterval()},150),c._interval.unref&&c._interval.unref()),c._debug("connect"),c.emit("connect")}else setTimeout(a,100)}function s(e){i=!0;var t=o[e.localCandidateId];t&&t.ip?(c.localAddress=t.ip,c.localPort=Number(t.port)):t&&t.ipAddress?(c.localAddress=t.ipAddress,c.localPort=Number(t.portNumber)):"string"==typeof e.googLocalAddress&&(t=e.googLocalAddress.split(":"),c.localAddress=t[0],c.localPort=Number(t[1]));var n=r[e.remoteCandidateId];n&&n.ip?(c.remoteAddress=n.ip,c.remotePort=Number(n.port)):n&&n.ipAddress?(c.remoteAddress=n.ipAddress,c.remotePort=Number(n.portNumber)):"string"==typeof e.googRemoteAddress&&(n=e.googRemoteAddress.split(":"),c.remoteAddress=n[0],c.remotePort=Number(n[1])),c.remoteFamily="IPv4",c._debug("connect local: %s:%s remote: %s:%s",c.localAddress,c.localPort,c.remoteAddress,c.remotePort)}})}())},a.prototype._onInterval=function(){!this._cb||!this._channel||65536<this._channel.bufferedAmount||this._onChannelBufferedAmountLow()},a.prototype._onSignalingStateChange=function(){var t=this;t.destroyed||("stable"===t._pc.signalingState&&(t._isNegotiating=!1,t._debug("flushing sender queue",t._sendersAwaitingStable),t._sendersAwaitingStable.forEach(function(e){t.removeTrack(e),t._queuedNegotiation=!0}),t._sendersAwaitingStable=[],t._queuedNegotiation&&(t._debug("flushing negotiation queue"),t._queuedNegotiation=!1,t._needsNegotiation()),t._debug("negotiate"),t.emit("negotiate")),t._debug("signalingStateChange %s",t._pc.signalingState),t.emit("signalingStateChange",t._pc.signalingState))},a.prototype._onIceCandidate=function(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||(this._iceComplete=!0,this.emit("_iceComplete")))},a.prototype._onChannelMessage=function(e){if(!this.destroyed){var t=e.data;t instanceof ArrayBuffer&&(t=n.from(t)),this.push(t)}},a.prototype._onChannelBufferedAmountLow=function(){!this.destroyed&&this._cb&&(this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount),(0,this._cb)(this._cb=null))},a.prototype._onChannelOpen=function(){this.connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())},a.prototype._onChannelClose=function(){this.destroyed||(this._debug("on channel close"),this.destroy())},a.prototype._onTrack=function(e){var n=this;n.destroyed||e.streams.forEach(function(t){n._debug("on track"),n.emit("track",e.track,t),n._remoteTracks.push({track:e.track,stream:t}),n._remoteStreams.some(function(e){return e.id===t.id})||(n._remoteStreams.push(t),setTimeout(function(){n.emit("stream",t)},0))})},a.prototype._debug=function(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],t.apply(null,e)},a.prototype._transformConstraints=function(e){if(0===Object.keys(e).length)return e;if(!e.mandatory&&!e.optional||this._isChromium)return e.mandatory||e.optional||!this._isChromium?e:(void 0!==e.offerToReceiveVideo&&(e.OfferToReceiveVideo=e.offerToReceiveVideo,delete e.offerToReceiveVideo),void 0!==e.offerToReceiveAudio&&(e.OfferToReceiveAudio=e.offerToReceiveAudio,delete e.offerToReceiveAudio),{mandatory:e});var t=Object.assign({},e.optional,e.mandatory);return void 0!==t.OfferToReceiveVideo&&(t.offerToReceiveVideo=t.OfferToReceiveVideo,delete t.OfferToReceiveVideo),void 0!==t.OfferToReceiveAudio&&(t.offerToReceiveAudio=t.OfferToReceiveAudio,delete t.OfferToReceiveAudio),t}}).call(this,l(12).Buffer)},function(o,i,e){"use strict";(function(t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e){return(r="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(e){return n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)})(e)}i.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":r(console))&&console.log&&(e=console).log.apply(e,arguments)},i.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+o.exports.humanize(this.diff),!this.useColors)return;var t="color: "+this.color;e.splice(1,0,t,"color: inherit");var n=0,r=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(n++,"%c"===e&&(r=n))}),e.splice(r,0,t)},i.save=function(e){try{e?i.storage.setItem("debug",e):i.storage.removeItem("debug")}catch(e){}},i.load=function(){var e;try{e=i.storage.getItem("debug")}catch(e){}!e&&void 0!==t&&"env"in t&&(e=t.env.DEBUG);return e},i.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},i.storage=function(){try{return localStorage}catch(e){}}(),i.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],o.exports=e(99)(i),o.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,e(1))},function(e,t,i){"use strict";e.exports=function(t){function n(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return u.colors[Math.abs(t)%u.colors.length]}function u(e){var a;function c(){if(c.enabled){for(var e=arguments.length,o=new Array(e),t=0;t<e;t++)o[t]=arguments[t];var i=c,n=Number(new Date),r=n-(a||n);i.diff=r,i.prev=a,i.curr=n,a=n,o[0]=u.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var s=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(e,t){if("%%"===e)return e;s++;var n=u.formatters[t];if("function"==typeof n){var r=o[s];e=n.call(i,r),o.splice(s,1),s--}return e}),u.formatArgs.call(i,o),(i.log||u.log).apply(i,o)}}return c.namespace=e,c.enabled=u.enabled(e),c.useColors=u.useColors(),c.color=n(e),c.destroy=r,c.extend=o,"function"==typeof u.init&&u.init(c),u.instances.push(c),c}function r(){var e=u.instances.indexOf(this);return-1!==e&&(u.instances.splice(e,1),!0)}function o(e,t){return u(this.namespace+(void 0===t?":":t)+e)}return((u.debug=u).default=u).coerce=function(e){return e instanceof Error?e.stack||e.message:e},u.disable=function(){u.enable("")},u.enable=function(e){var t;u.save(e),u.names=[],u.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(t=0;t<r;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?u.skips.push(new RegExp("^"+e.substr(1)+"$")):u.names.push(new RegExp("^"+e+"$")));for(t=0;t<u.instances.length;t++){var o=u.instances[t];o.enabled=u.enabled(o.namespace)}},u.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=u.skips.length;t<n;t++)if(u.skips[t].test(e))return!1;for(t=0,n=u.names.length;t<n;t++)if(u.names[t].test(e))return!0;return!1},u.humanize=i(38),Object.keys(t).forEach(function(e){u[e]=t[e]}),u.instances=[],u.names=[],u.skips=[],u.formatters={},u.selectColor=n,u.enable(u.load()),u}},function(e,t){e.exports=function(){if("undefined"==typeof window)return null;var e={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}},function(e,t,n){"use strict";(function(o,i){var s=n(13).Buffer,a=o.crypto||o.msCrypto;a&&a.getRandomValues?e.exports=function(e,t){if(65536<e)throw new Error("requested too many random bytes");var n=new o.Uint8Array(e);0<e&&a.getRandomValues(n);var r=s.from(n.buffer);return"function"!=typeof t?r:i.nextTick(function(){t(null,r)})}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this,n(0),n(1))},function(e,t,n){(((t=e.exports=n(40)).Stream=t).Readable=t).Writable=n(43),t.Duplex=n(11),t.Transform=n(45),t.PassThrough=n(109)},function(e,t){},function(e,t,n){"use strict";var a=n(13).Buffer,r=n(105);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};0<this.length?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return a.alloc(0);if(1===this.length)return this.head.data;for(var t,n,r,o=a.allocUnsafe(e>>>0),i=this.head,s=0;i;)t=i.data,n=o,r=s,t.copy(n,r),s+=i.data.length,i=i.next;return o},e}(),r&&r.inspect&&r.inspect.custom&&(e.exports.prototype[r.inspect.custom]=function(){var e=r.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,o,i){(function(e){var t=void 0!==e&&e||"undefined"!=typeof self&&self||window,n=Function.prototype.apply;function r(e,t){this._id=e,this._clearFn=t}o.setTimeout=function(){return new r(n.call(setTimeout,t,arguments),clearTimeout)},o.setInterval=function(){return new r(n.call(setInterval,t,arguments),clearInterval)},o.clearTimeout=o.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(t,this._id)},o.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},o.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},o._unrefActive=o.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},i(107),o.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,o.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,i(0))},function(e,t,n){(function(e,d){!function(n,r){"use strict";if(!n.setImmediate){var o,i,t,s,e,a=1,c={},u=!1,f=n.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(n);l=l&&l.setTimeout?l:n,o="[object process]"==={}.toString.call(n.process)?function(e){d.nextTick(function(){p(e)})}:function(){if(n.postMessage&&!n.importScripts){var e=!0,t=n.onmessage;return n.onmessage=function(){e=!1},n.postMessage("","*"),n.onmessage=t,e}}()?(s="setImmediate$"+Math.random()+"$",e=function(e){e.source===n&&"string"==typeof e.data&&0===e.data.indexOf(s)&&p(+e.data.slice(s.length))},n.addEventListener?n.addEventListener("message",e,!1):n.attachEvent("onmessage",e),function(e){n.postMessage(s+e,"*")}):n.MessageChannel?((t=new MessageChannel).port1.onmessage=function(e){p(e.data)},function(e){t.port2.postMessage(e)}):f&&"onreadystatechange"in f.createElement("script")?(i=f.documentElement,function(e){var t=f.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):function(e){setTimeout(p,0,e)},l.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return c[a]=r,o(a),a++},l.clearImmediate=h}function h(e){delete c[e]}function p(e){if(u)setTimeout(p,0,e);else{var t=c[e];if(t){u=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(r,n)}}(t)}finally{h(e),u=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(0),n(1))},function(e,t,n){(function(n){function r(e){try{if(!n.localStorage)return!1}catch(e){return!1}var t=n.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this,n(0))},function(e,t,n){"use strict";e.exports=i;var r=n(45),o=n(14);function i(e){if(!(this instanceof i))return new i(e);r.call(this,e)}o.inherits=n(10),o.inherits(i,r),i.prototype._transform=function(e,t,n){n(null,e)}},function(e){e.exports={port:5555,host:"http://localhost",max:20}}])});
//# sourceMappingURL=n2n-wrtc.bundle.min.js.map